/*! For license information please see boundle.js.LICENSE.txt */
(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let r=t.charCodeAt(i);r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=63&r|128):55296==(64512&r)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(r=65536+((1023&r)<<10)+(1023&t.charCodeAt(++i)),e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=63&r|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=63&r|128)}return e},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let e=0;e<t.length;e+=3){const r=t[e],s=e+1<t.length,o=s?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,h=r>>2,u=(3&r)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(l=64)),i.push(n[h],n[u],n[l],n[d])}return i.join("")},encodeString(t,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(t):this.encodeByteArray(e(t),n)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,i=0;for(;n<t.length;){const r=t[n++];if(r<128)e[i++]=String.fromCharCode(r);else if(r>191&&r<224){const s=t[n++];e[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){const s=((7&r)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[i++]=String.fromCharCode(55296+(s>>10)),e[i++]=String.fromCharCode(56320+(1023&s))}else{const s=t[n++],o=t[n++];e[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let e=0;e<t.length;){const s=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const c=e<t.length?n[t.charAt(e)]:64;if(++e,null==s||null==o||null==a||null==c)throw new i;const h=s<<2|o>>4;if(r.push(h),64!==a){const t=o<<4&240|a>>2;if(r.push(t),64!==c){const t=a<<6&192|c;r.push(t)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class i extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const r=function(t){return function(t){const i=e(t);return n.encodeByteArray(i,!0)}(t).replace(/\./g,"")},s=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t.g)return t.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return n.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},o=()=>{var t;return null===(t=s())||void 0===t?void 0:t.config};class a{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function c(){try{return"object"==typeof indexedDB}catch(t){return!1}}function h(){return new Promise(((t,e)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var t;e((null===(t=r.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}))}class u extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,u.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,l.prototype.create)}}class l{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},i=`${this.service}/${t}`,r=this.errors[t],s=r?function(t,e){return t.replace(d,((t,n)=>{const i=e[n];return null!=i?String(i):`<${n}?>`}))}(r,n):"Error",o=`${this.serviceName}: ${s} (${i}).`;return new u(i,o,n)}}const d=/\{\$([^}]+)}/g;function f(t,e){if(t===e)return!0;const n=Object.keys(t),i=Object.keys(e);for(const r of n){if(!i.includes(r))return!1;const n=t[r],s=e[r];if(p(n)&&p(s)){if(!f(n,s))return!1}else if(n!==s)return!1}for(const t of i)if(!n.includes(t))return!1;return!0}function p(t){return null!==t&&"object"==typeof t}const g=1e3,m=2,y=144e5,v=.5;function w(t,e=g,n=m){const i=e*Math.pow(n,t),r=Math.round(v*i*(Math.random()-.5)*2);return Math.min(y,i+r)}function E(t){return t&&t._delegate?t._delegate:t}class b{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const T="[DEFAULT]";class I{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new a;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),i=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(i)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:T})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=T){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=T){return this.instances.has(t)}getOptions(t=T){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(i);return i}onInit(t,e){var n;const i=this.normalizeInstanceIdentifier(e),r=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;r.add(t),this.onInitCallbacks.set(i,r);const s=this.instances.get(i);return s&&t(s,i),()=>{r.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const i of n)try{i(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=t,i===T?void 0:i),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var i;return n||null}normalizeInstanceIdentifier(t=T){return this.component?this.component.multipleInstances?t:T:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class _{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new I(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const C=[];var S,A;(A=S||(S={}))[A.DEBUG=0]="DEBUG",A[A.VERBOSE=1]="VERBOSE",A[A.INFO=2]="INFO",A[A.WARN=3]="WARN",A[A.ERROR=4]="ERROR",A[A.SILENT=5]="SILENT";const D={debug:S.DEBUG,verbose:S.VERBOSE,info:S.INFO,warn:S.WARN,error:S.ERROR,silent:S.SILENT},k=S.INFO,N={[S.DEBUG]:"log",[S.VERBOSE]:"log",[S.INFO]:"info",[S.WARN]:"warn",[S.ERROR]:"error"},R=(t,e,...n)=>{if(e<t.logLevel)return;const i=(new Date).toISOString(),r=N[e];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[r](`[${i}]  ${t.name}:`,...n)};class x{constructor(t){this.name=t,this._logLevel=k,this._logHandler=R,this._userLogHandler=null,C.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in S))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?D[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,S.DEBUG,...t),this._logHandler(this,S.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,S.VERBOSE,...t),this._logHandler(this,S.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,S.INFO,...t),this._logHandler(this,S.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,S.WARN,...t),this._logHandler(this,S.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,S.ERROR,...t),this._logHandler(this,S.ERROR,...t)}}const L=(t,e)=>e.some((e=>t instanceof e));let M,O;const P=new WeakMap,F=new WeakMap,V=new WeakMap,U=new WeakMap,B=new WeakMap;let j={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return F.get(t);if("objectStoreNames"===e)return t.objectStoreNames||V.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return q(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function $(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(O||(O=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(z(this),t),q(P.get(this))}:function(...t){return q(e.apply(z(this),t))}:function(t,...n){const i=e.call(z(this),t,...n);return V.set(i,t.sort?t.sort():[t]),q(i)}:(t instanceof IDBTransaction&&function(t){if(F.has(t))return;const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",s),t.removeEventListener("abort",s)},r=()=>{e(),i()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",r),t.addEventListener("error",s),t.addEventListener("abort",s)}));F.set(t,e)}(t),L(t,M||(M=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,j):t);var e}function q(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("success",r),t.removeEventListener("error",s)},r=()=>{e(q(t.result)),i()},s=()=>{n(t.error),i()};t.addEventListener("success",r),t.addEventListener("error",s)}));return e.then((e=>{e instanceof IDBCursor&&P.set(e,t)})).catch((()=>{})),B.set(e,t),e}(t);if(U.has(t))return U.get(t);const e=$(t);return e!==t&&(U.set(t,e),B.set(e,t)),e}const z=t=>B.get(t),K=["get","getKey","getAll","getAllKeys","count"],H=["put","add","delete","clear"],G=new Map;function Q(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(G.get(e))return G.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,r=H.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!K.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,r?"readwrite":"readonly");let o=s.store;return i&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),r&&s.done]))[0]};return G.set(e,s),s}var W;W=j,j={...W,get:(t,e,n)=>Q(t,e)||W.get(t,e,n),has:(t,e)=>!!Q(t,e)||W.has(t,e)};class X{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const J="@firebase/app",Y="0.9.15",Z=new x("@firebase/app"),tt="[DEFAULT]",et={[J]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},nt=new Map,it=new Map;function rt(t,e){try{t.container.addComponent(e)}catch(n){Z.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function st(t){const e=t.name;if(it.has(e))return Z.debug(`There were multiple attempts to register component ${e}.`),!1;it.set(e,t);for(const e of nt.values())rt(e,t);return!0}function ot(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}const at=new l("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class ct{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new b("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw at.create("app-deleted",{appName:this._name})}}function ht(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const i=Object.assign({name:tt,automaticDataCollectionEnabled:!1},e),r=i.name;if("string"!=typeof r||!r)throw at.create("bad-app-name",{appName:String(r)});if(n||(n=o()),!n)throw at.create("no-options");const s=nt.get(r);if(s){if(f(n,s.options)&&f(i,s.config))return s;throw at.create("duplicate-app",{appName:r})}const a=new _(r);for(const t of it.values())a.addComponent(t);const c=new ct(n,i,a);return nt.set(r,c),c}function ut(t=tt){const e=nt.get(t);if(!e&&t===tt&&o())return ht();if(!e)throw at.create("no-app",{appName:t});return e}function lt(t,e,n){var i;let r=null!==(i=et[t])&&void 0!==i?i:t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const t=[`Unable to register library "${r}" with version "${e}":`];return s&&t.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void Z.warn(t.join(" "))}st(new b(`${r}-version`,(()=>({library:r,version:e})),"VERSION"))}const dt="firebase-heartbeat-database",ft=1,pt="firebase-heartbeat-store";let gt=null;function mt(){return gt||(gt=function(t,e,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){const o=indexedDB.open(t,e),a=q(o);return i&&o.addEventListener("upgradeneeded",(t=>{i(q(o.result),t.oldVersion,t.newVersion,q(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{s&&t.addEventListener("close",(()=>s())),r&&t.addEventListener("versionchange",(t=>r(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}(dt,ft,{upgrade:(t,e)=>{0===e&&t.createObjectStore(pt)}}).catch((t=>{throw at.create("idb-open",{originalErrorMessage:t.message})}))),gt}async function yt(t,e){try{const n=(await mt()).transaction(pt,"readwrite"),i=n.objectStore(pt);await i.put(e,vt(t)),await n.done}catch(t){if(t instanceof u)Z.warn(t.message);else{const e=at.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});Z.warn(e.message)}}}function vt(t){return`${t.name}!${t.options.appId}`}class wt{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new bt(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=Et();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==e&&!this._heartbeatsCache.heartbeats.some((t=>t.date===e)))return this._heartbeatsCache.heartbeats.push({date:e,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const t=Et(),{heartbeatsToSend:e,unsentEntries:n}=function(t,e=1024){const n=[];let i=t.slice();for(const r of t){const t=n.find((t=>t.agent===r.agent));if(t){if(t.dates.push(r.date),Tt(n)>e){t.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),Tt(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=r(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function Et(){return(new Date).toISOString().substring(0,10)}class bt{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!c()&&h().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=await mt();return await e.transaction(pt).objectStore(pt).get(vt(t))}catch(t){if(t instanceof u)Z.warn(t.message);else{const e=at.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});Z.warn(e.message)}}}(this.app);return t||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return yt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return yt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function Tt(t){return r(JSON.stringify({version:2,heartbeats:t})).length}st(new b("platform-logger",(t=>new X(t)),"PRIVATE")),st(new b("heartbeat",(t=>new wt(t)),"PRIVATE")),lt(J,Y,""),lt(J,Y,"esm2017"),lt("fire-js",""),lt("firebase","10.1.0","app");const It=(t,e)=>e.some((e=>t instanceof e));let _t,Ct;const St=new WeakMap,At=new WeakMap,Dt=new WeakMap,kt=new WeakMap,Nt=new WeakMap;let Rt={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return At.get(t);if("objectStoreNames"===e)return t.objectStoreNames||Dt.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Lt(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function xt(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Ct||(Ct=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(Mt(this),t),Lt(St.get(this))}:function(...t){return Lt(e.apply(Mt(this),t))}:function(t,...n){const i=e.call(Mt(this),t,...n);return Dt.set(i,t.sort?t.sort():[t]),Lt(i)}:(t instanceof IDBTransaction&&function(t){if(At.has(t))return;const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",s),t.removeEventListener("abort",s)},r=()=>{e(),i()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",r),t.addEventListener("error",s),t.addEventListener("abort",s)}));At.set(t,e)}(t),It(t,_t||(_t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,Rt):t);var e}function Lt(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("success",r),t.removeEventListener("error",s)},r=()=>{e(Lt(t.result)),i()},s=()=>{n(t.error),i()};t.addEventListener("success",r),t.addEventListener("error",s)}));return e.then((e=>{e instanceof IDBCursor&&St.set(e,t)})).catch((()=>{})),Nt.set(e,t),e}(t);if(kt.has(t))return kt.get(t);const e=xt(t);return e!==t&&(kt.set(t,e),Nt.set(e,t)),e}const Mt=t=>Nt.get(t),Ot=["get","getKey","getAll","getAllKeys","count"],Pt=["put","add","delete","clear"],Ft=new Map;function Vt(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(Ft.get(e))return Ft.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,r=Pt.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!Ot.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,r?"readwrite":"readonly");let o=s.store;return i&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),r&&s.done]))[0]};return Ft.set(e,s),s}Rt=(t=>({...t,get:(e,n,i)=>Vt(e,n)||t.get(e,n,i),has:(e,n)=>!!Vt(e,n)||t.has(e,n)}))(Rt);const Ut="@firebase/installations",Bt="0.6.4",jt=1e4,$t=`w:${Bt}`,qt="FIS_v2",zt="https://firebaseinstallations.googleapis.com/v1",Kt=36e5,Ht=new l("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Gt(t){return t instanceof u&&t.code.includes("request-failed")}function Qt({projectId:t}){return`${zt}/projects/${t}/installations`}function Wt(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}async function Xt(t,e){const n=(await e.json()).error;return Ht.create("request-failed",{requestName:t,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function Jt({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}async function Yt(t){const e=await t();return e.status>=500&&e.status<600?t():e}function Zt(t){return new Promise((e=>{setTimeout(e,t)}))}const te=/^[cdef][\w-]{21}$/,ee="";function ne(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const e=function(t){var e;return(e=t,btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(t);return te.test(e)?e:ee}catch(t){return ee}}function ie(t){return`${t.appName}!${t.appId}`}const re=new Map;function se(t,e){const n=ie(t);oe(n,e),function(t,e){const n=(!ae&&"BroadcastChannel"in self&&(ae=new BroadcastChannel("[Firebase] FID Change"),ae.onmessage=t=>{oe(t.data.key,t.data.fid)}),ae);n&&n.postMessage({key:t,fid:e}),0===re.size&&ae&&(ae.close(),ae=null)}(n,e)}function oe(t,e){const n=re.get(t);if(n)for(const t of n)t(e)}let ae=null;const ce="firebase-installations-database",he=1,ue="firebase-installations-store";let le=null;function de(){return le||(le=function(t,e,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){const o=indexedDB.open(t,e),a=Lt(o);return i&&o.addEventListener("upgradeneeded",(t=>{i(Lt(o.result),t.oldVersion,t.newVersion,Lt(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((t=>{s&&t.addEventListener("close",(()=>s())),r&&t.addEventListener("versionchange",(()=>r()))})).catch((()=>{})),a}(ce,he,{upgrade:(t,e)=>{0===e&&t.createObjectStore(ue)}})),le}async function fe(t,e){const n=ie(t),i=(await de()).transaction(ue,"readwrite"),r=i.objectStore(ue),s=await r.get(n);return await r.put(e,n),await i.done,s&&s.fid===e.fid||se(t,e.fid),e}async function pe(t){const e=ie(t),n=(await de()).transaction(ue,"readwrite");await n.objectStore(ue).delete(e),await n.done}async function ge(t,e){const n=ie(t),i=(await de()).transaction(ue,"readwrite"),r=i.objectStore(ue),s=await r.get(n),o=e(s);return void 0===o?await r.delete(n):await r.put(o,n),await i.done,!o||s&&s.fid===o.fid||se(t,o.fid),o}async function me(t){let e;const n=await ge(t.appConfig,(n=>{const i=function(t){return we(t||{fid:ne(),registrationStatus:0})}(n),r=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(Ht.create("app-offline"))};const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=async function(t,e){try{const n=await async function({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const i=Qt(t),r=Jt(t),s=e.getImmediate({optional:!0});if(s){const t=await s.getHeartbeatsHeader();t&&r.append("x-firebase-client",t)}const o={fid:n,authVersion:qt,appId:t.appId,sdkVersion:$t},a={method:"POST",headers:r,body:JSON.stringify(o)},c=await Yt((()=>fetch(i,a)));if(c.ok){const t=await c.json();return{fid:t.fid||n,registrationStatus:2,refreshToken:t.refreshToken,authToken:Wt(t.authToken)}}throw await Xt("Create Installation",c)}(t,e);return fe(t.appConfig,n)}catch(n){throw Gt(n)&&409===n.customData.serverCode?await pe(t.appConfig):await fe(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}(t,n);return{installationEntry:n,registrationPromise:i}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:ye(t)}:{installationEntry:e}}(t,i);return e=r.registrationPromise,r.installationEntry}));return n.fid===ee?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}async function ye(t){let e=await ve(t.appConfig);for(;1===e.registrationStatus;)await Zt(100),e=await ve(t.appConfig);if(0===e.registrationStatus){const{installationEntry:e,registrationPromise:n}=await me(t);return n||e}return e}function ve(t){return ge(t,(t=>{if(!t)throw Ht.create("installation-not-found");return we(t)}))}function we(t){return 1===(e=t).registrationStatus&&e.registrationTime+jt<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e}async function Ee({appConfig:t,heartbeatServiceProvider:e},n){const i=function(t,{fid:e}){return`${Qt(t)}/${e}/authTokens:generate`}(t,n),r=function(t,{refreshToken:e}){const n=Jt(t);return n.append("Authorization",function(t){return`${qt} ${t}`}(e)),n}(t,n),s=e.getImmediate({optional:!0});if(s){const t=await s.getHeartbeatsHeader();t&&r.append("x-firebase-client",t)}const o={installation:{sdkVersion:$t,appId:t.appId}},a={method:"POST",headers:r,body:JSON.stringify(o)},c=await Yt((()=>fetch(i,a)));if(c.ok)return Wt(await c.json());throw await Xt("Generate Auth Token",c)}async function be(t,e=!1){let n;const i=await ge(t.appConfig,(i=>{if(!Ie(i))throw Ht.create("not-registered");const r=i.authToken;if(!e&&(2===(s=r).requestStatus&&!function(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+Kt}(s)))return i;var s;if(1===r.requestStatus)return n=async function(t,e){let n=await Te(t.appConfig);for(;1===n.authToken.requestStatus;)await Zt(100),n=await Te(t.appConfig);const i=n.authToken;return 0===i.requestStatus?be(t,e):i}(t,e),i;{if(!navigator.onLine)throw Ht.create("app-offline");const e=function(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}(i);return n=async function(t,e){try{const n=await Ee(t,e),i=Object.assign(Object.assign({},e),{authToken:n});return await fe(t.appConfig,i),n}catch(n){if(!Gt(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await fe(t.appConfig,n)}else await pe(t.appConfig);throw n}}(t,e),e}}));return n?await n:i.authToken}function Te(t){return ge(t,(t=>{if(!Ie(t))throw Ht.create("not-registered");return 1===(e=t.authToken).requestStatus&&e.requestTime+jt<Date.now()?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t;var e}))}function Ie(t){return void 0!==t&&2===t.registrationStatus}function _e(t){return Ht.create("missing-app-config-values",{valueName:t})}const Ce="installations";st(new b(Ce,(t=>{const e=t.getProvider("app").getImmediate(),n=function(t){if(!t||!t.options)throw _e("App Configuration");if(!t.name)throw _e("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw _e(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e);return{app:e,appConfig:n,heartbeatServiceProvider:ot(e,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),st(new b("installations-internal",(t=>{const e=ot(t.getProvider("app").getImmediate(),Ce).getImmediate();return{getId:()=>async function(t){const e=t,{installationEntry:n,registrationPromise:i}=await me(e);return i?i.catch(console.error):be(e).catch(console.error),n.fid}(e),getToken:t=>async function(t,e=!1){const n=t;return await async function(t){const{registrationPromise:e}=await me(t);e&&await e}(n),(await be(n,e)).token}(e,t)}}),"PRIVATE")),lt(Ut,Bt),lt(Ut,Bt,"esm2017");const Se="analytics",Ae="firebase_id",De="origin",ke=6e4,Ne="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Re="https://www.googletagmanager.com/gtag/js",xe=new x("@firebase/analytics"),Le=new l("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function Me(t){if(!t.startsWith(Re)){const e=Le.create("invalid-gtag-resource",{gtagURL:t});return xe.warn(e.message),""}return t}function Oe(t){return Promise.all(t.map((t=>t.catch((t=>t)))))}const Pe=30,Fe=new class{constructor(t={},e=1e3){this.throttleMetadata=t,this.intervalMillis=e}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,e){this.throttleMetadata[t]=e}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}};function Ve(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function Ue(t,e=Fe,n){const{appId:i,apiKey:r,measurementId:s}=t.options;if(!i)throw Le.create("no-app-id");if(!r){if(s)return{measurementId:s,appId:i};throw Le.create("no-api-key")}const o=e.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new je;return setTimeout((async()=>{a.abort()}),void 0!==n?n:ke),Be({appId:i,apiKey:r,measurementId:s},o,a,e)}async function Be(t,{throttleEndTimeMillis:e,backoffCount:n},i,r=Fe){var s;const{appId:o,measurementId:a}=t;try{await function(t,e){return new Promise(((n,i)=>{const r=Math.max(e-Date.now(),0),s=setTimeout(n,r);t.addEventListener((()=>{clearTimeout(s),i(Le.create("fetch-throttle",{throttleEndTimeMillis:e}))}))}))}(i,e)}catch(t){if(a)return xe.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==t?void 0:t.message}]`),{appId:o,measurementId:a};throw t}try{const e=await async function(t){var e;const{appId:n,apiKey:i}=t,r={method:"GET",headers:Ve(i)},s=Ne.replace("{app-id}",n),o=await fetch(s,r);if(200!==o.status&&304!==o.status){let t="";try{const n=await o.json();(null===(e=n.error)||void 0===e?void 0:e.message)&&(t=n.error.message)}catch(t){}throw Le.create("config-fetch-failed",{httpStatus:o.status,responseMessage:t})}return o.json()}(t);return r.deleteThrottleMetadata(o),e}catch(e){const c=e;if(!function(t){if(!(t instanceof u&&t.customData))return!1;const e=Number(t.customData.httpStatus);return 429===e||500===e||503===e||504===e}(c)){if(r.deleteThrottleMetadata(o),a)return xe.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==c?void 0:c.message}]`),{appId:o,measurementId:a};throw e}const h=503===Number(null===(s=null==c?void 0:c.customData)||void 0===s?void 0:s.httpStatus)?w(n,r.intervalMillis,Pe):w(n,r.intervalMillis),l={throttleEndTimeMillis:Date.now()+h,backoffCount:n+1};return r.setThrottleMetadata(o,l),xe.debug(`Calling attemptFetch again in ${h} millis`),Be(t,l,i,r)}}class je{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach((t=>t()))}}let $e,qe;async function ze(t,e,n,i,r,s,o){var a;const u=Ue(t);u.then((e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&xe.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${e.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((t=>xe.error(t))),e.push(u);const l=async function(){if(!c())return xe.warn(Le.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await h()}catch(t){return xe.warn(Le.create("indexeddb-unavailable",{errorInfo:null==t?void 0:t.toString()}).message),!1}return!0}().then((t=>t?i.getId():void 0)),[d,f]=await Promise.all([u,l]);(function(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(Re)&&n.src.includes(t))return n;return null})(s)||function(t,e){const n=function(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy("firebase-js-sdk-policy",e)),n}(0,{createScriptURL:Me}),i=document.createElement("script"),r=`${Re}?l=${t}&id=${e}`;i.src=n?null==n?void 0:n.createScriptURL(r):r,i.async=!0,document.head.appendChild(i)}(s,d.measurementId),qe&&(r("consent","default",qe),qe=void 0),r("js",new Date);const p=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return p[De]="firebase",p.update=!0,null!=f&&(p[Ae]=f),r("config",d.measurementId,p),$e&&(r("set",$e),$e=void 0),d.measurementId}class Ke{constructor(t){this.app=t}_delete(){return delete He[this.app.options.appId],Promise.resolve()}}let He={},Ge=[];const Qe={};let We,Xe,Je="dataLayer",Ye=!1;function Ze(t,e,n){!function(){const t=[];if(function(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()&&t.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||t.push("Cookies are not available."),t.length>0){const e=t.map(((t,e)=>`(${e+1}) ${t}`)).join(" "),n=Le.create("invalid-analytics-context",{errorInfo:e});xe.warn(n.message)}}();const i=t.options.appId;if(!i)throw Le.create("no-app-id");if(!t.options.apiKey){if(!t.options.measurementId)throw Le.create("no-api-key");xe.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=He[i])throw Le.create("already-exists",{id:i});if(!Ye){!function(t){let e=[];Array.isArray(window[t])?e=window[t]:window[t]=e}(Je);const{wrappedGtag:t,gtagCore:e}=function(t,e,n,i,r){let s=function(...t){window[i].push(arguments)};return window[r]&&"function"==typeof window[r]&&(s=window[r]),window[r]=function(t,e,n,i){return async function(r,...s){try{if("event"===r){const[i,r]=s;await async function(t,e,n,i,r){try{let s=[];if(r&&r.send_to){let t=r.send_to;Array.isArray(t)||(t=[t]);const i=await Oe(n);for(const n of t){const t=i.find((t=>t.measurementId===n)),r=t&&e[t.appId];if(!r){s=[];break}s.push(r)}}0===s.length&&(s=Object.values(e)),await Promise.all(s),t("event",i,r||{})}catch(t){xe.error(t)}}(t,e,n,i,r)}else if("config"===r){const[r,o]=s;await async function(t,e,n,i,r,s){const o=i[r];try{if(o)await e[o];else{const t=(await Oe(n)).find((t=>t.measurementId===r));t&&await e[t.appId]}}catch(t){xe.error(t)}t("config",r,s)}(t,e,n,i,r,o)}else if("consent"===r){const[e]=s;t("consent","update",e)}else if("get"===r){const[e,n,i]=s;t("get",e,n,i)}else if("set"===r){const[e]=s;t("set",e)}else t(r,...s)}catch(t){xe.error(t)}}}(s,t,e,n),{gtagCore:s,wrappedGtag:window[r]}}(He,Ge,Qe,Je,"gtag");Xe=t,We=e,Ye=!0}return He[i]=ze(t,Ge,Qe,e,We,Je,n),new Ke(t)}const tn="@firebase/analytics",en="0.10.0";st(new b(Se,((t,{options:e})=>Ze(t.getProvider("app").getImmediate(),t.getProvider("installations-internal").getImmediate(),e)),"PUBLIC")),st(new b("analytics-internal",(function(t){try{const e=t.getProvider(Se).getImmediate();return{logEvent:(t,n,i)=>function(t,e,n,i){t=E(t),async function(t,e,n,i,r){if(r&&r.global)t("event",n,i);else{const r=await e;t("event",n,Object.assign(Object.assign({},i),{send_to:r}))}}(Xe,He[t.app.options.appId],e,n,i).catch((t=>xe.error(t)))}(e,t,n,i)}}catch(t){throw Le.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),lt(tn,en),lt(tn,en,"esm2017");var nn,rn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},sn={},on=on||{},an=rn||self;function cn(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function hn(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var un="closure_uid_"+(1e9*Math.random()>>>0),ln=0;function dn(t,e,n){return t.call.apply(t.bind,arguments)}function fn(t,e,n){if(!t)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function pn(t,e,n){return(pn=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?dn:fn).apply(null,arguments)}function gn(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function mn(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(t,n,i){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return e.prototype[n].apply(t,r)}}function yn(){this.s=this.s,this.o=this.o}yn.prototype.s=!1,yn.prototype.sa=function(){var t;!this.s&&(this.s=!0,this.N(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,un)&&t[un]||(t[un]=++ln))},yn.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const vn=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function wn(t){const e=t.length;if(0<e){const n=Array(e);for(let i=0;i<e;i++)n[i]=t[i];return n}return[]}function En(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(cn(n)){const e=t.length||0,i=n.length||0;t.length=e+i;for(let r=0;r<i;r++)t[e+r]=n[r]}else t.push(n)}}function bn(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}bn.prototype.h=function(){this.defaultPrevented=!0};var Tn=function(){if(!an.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{an.addEventListener("test",(()=>{}),e),an.removeEventListener("test",(()=>{}),e)}catch(t){}return t}();function In(t){return/^[\s\xa0]*$/.test(t)}function _n(){var t=an.navigator;return t&&(t=t.userAgent)?t:""}function Cn(t){return-1!=_n().indexOf(t)}function Sn(t){return Sn[" "](t),t}Sn[" "]=function(){};var An,Dn,kn,Nn=Cn("Opera"),Rn=Cn("Trident")||Cn("MSIE"),xn=Cn("Edge"),Ln=xn||Rn,Mn=Cn("Gecko")&&!(-1!=_n().toLowerCase().indexOf("webkit")&&!Cn("Edge"))&&!(Cn("Trident")||Cn("MSIE"))&&!Cn("Edge"),On=-1!=_n().toLowerCase().indexOf("webkit")&&!Cn("Edge");function Pn(){var t=an.document;return t?t.documentMode:void 0}t:{var Fn="",Vn=(Dn=_n(),Mn?/rv:([^\);]+)(\)|;)/.exec(Dn):xn?/Edge\/([\d\.]+)/.exec(Dn):Rn?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Dn):On?/WebKit\/(\S+)/.exec(Dn):Nn?/(?:Version)[ \/]?(\S+)/.exec(Dn):void 0);if(Vn&&(Fn=Vn?Vn[1]:""),Rn){var Un=Pn();if(null!=Un&&Un>parseFloat(Fn)){An=String(Un);break t}}An=Fn}an.document&&Rn?kn=Pn()||parseInt(An,10)||void 0:kn=void 0;var Bn=kn;function jn(t,e){if(bn.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,i=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Mn){t:{try{Sn(e.nodeName);var r=!0;break t}catch(t){}r=!1}r||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:$n[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&jn.$.h.call(this)}}mn(jn,bn);var $n={2:"touch",3:"pen",4:"mouse"};jn.prototype.h=function(){jn.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var qn="closure_listenable_"+(1e6*Math.random()|0),zn=0;function Kn(t,e,n,i,r){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!i,this.la=r,this.key=++zn,this.fa=this.ia=!1}function Hn(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function Gn(t,e,n){for(const i in t)e.call(n,t[i],i,t)}function Qn(t){const e={};for(const n in t)e[n]=t[n];return e}const Wn="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Xn(t,e){let n,i;for(let e=1;e<arguments.length;e++){for(n in i=arguments[e],i)t[n]=i[n];for(let e=0;e<Wn.length;e++)n=Wn[e],Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}}function Jn(t){this.src=t,this.g={},this.h=0}function Yn(t,e){var n=e.type;if(n in t.g){var i,r=t.g[n],s=vn(r,e);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(Hn(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function Zn(t,e,n,i){for(var r=0;r<t.length;++r){var s=t[r];if(!s.fa&&s.listener==e&&s.capture==!!n&&s.la==i)return r}return-1}Jn.prototype.add=function(t,e,n,i,r){var s=t.toString();(t=this.g[s])||(t=this.g[s]=[],this.h++);var o=Zn(t,e,i,r);return-1<o?(e=t[o],n||(e.ia=!1)):((e=new Kn(e,this.src,s,!!i,r)).ia=n,t.push(e)),e};var ti="closure_lm_"+(1e6*Math.random()|0),ei={};function ni(t,e,n,i,r){if(i&&i.once)return ri(t,e,n,i,r);if(Array.isArray(e)){for(var s=0;s<e.length;s++)ni(t,e[s],n,i,r);return null}return n=li(n),t&&t[qn]?t.O(e,n,hn(i)?!!i.capture:!!i,r):ii(t,e,n,!1,i,r)}function ii(t,e,n,i,r,s){if(!e)throw Error("Invalid event type");var o=hn(r)?!!r.capture:!!r,a=hi(t);if(a||(t[ti]=a=new Jn(t)),(n=a.add(e,n,i,o,s)).proxy)return n;if(i=function(){const t=ci;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=i,i.src=t,i.listener=n,t.addEventListener)Tn||(r=o),void 0===r&&(r=!1),t.addEventListener(e.toString(),i,r);else if(t.attachEvent)t.attachEvent(ai(e.toString()),i);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(i)}return n}function ri(t,e,n,i,r){if(Array.isArray(e)){for(var s=0;s<e.length;s++)ri(t,e[s],n,i,r);return null}return n=li(n),t&&t[qn]?t.P(e,n,hn(i)?!!i.capture:!!i,r):ii(t,e,n,!0,i,r)}function si(t,e,n,i,r){if(Array.isArray(e))for(var s=0;s<e.length;s++)si(t,e[s],n,i,r);else i=hn(i)?!!i.capture:!!i,n=li(n),t&&t[qn]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=Zn(s=t.g[e],n,i,r))&&(Hn(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete t.g[e],t.h--))):t&&(t=hi(t))&&(e=t.g[e.toString()],t=-1,e&&(t=Zn(e,n,i,r)),(n=-1<t?e[t]:null)&&oi(n))}function oi(t){if("number"!=typeof t&&t&&!t.fa){var e=t.src;if(e&&e[qn])Yn(e.i,t);else{var n=t.type,i=t.proxy;e.removeEventListener?e.removeEventListener(n,i,t.capture):e.detachEvent?e.detachEvent(ai(n),i):e.addListener&&e.removeListener&&e.removeListener(i),(n=hi(e))?(Yn(n,t),0==n.h&&(n.src=null,e[ti]=null)):Hn(t)}}}function ai(t){return t in ei?ei[t]:ei[t]="on"+t}function ci(t,e){if(t.fa)t=!0;else{e=new jn(e,this);var n=t.listener,i=t.la||t.src;t.ia&&oi(t),t=n.call(i,e)}return t}function hi(t){return(t=t[ti])instanceof Jn?t:null}var ui="__closure_events_fn_"+(1e9*Math.random()>>>0);function li(t){return"function"==typeof t?t:(t[ui]||(t[ui]=function(e){return t.handleEvent(e)}),t[ui])}function di(){yn.call(this),this.i=new Jn(this),this.S=this,this.J=null}function fi(t,e){var n,i=t.J;if(i)for(n=[];i;i=i.J)n.push(i);if(t=t.S,i=e.type||e,"string"==typeof e)e=new bn(e,t);else if(e instanceof bn)e.target=e.target||t;else{var r=e;Xn(e=new bn(i,t),r)}if(r=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];r=pi(o,i,!0,e)&&r}if(r=pi(o=e.g=t,i,!0,e)&&r,r=pi(o,i,!1,e)&&r,n)for(s=0;s<n.length;s++)r=pi(o=e.g=n[s],i,!1,e)&&r}function pi(t,e,n,i){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var r=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&Yn(t.i,o),r=!1!==a.call(c,i)&&r}}return r&&!i.defaultPrevented}mn(di,yn),di.prototype[qn]=!0,di.prototype.removeEventListener=function(t,e,n,i){si(this,t,e,n,i)},di.prototype.N=function(){if(di.$.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],i=0;i<n.length;i++)Hn(n[i]);delete e.g[t],e.h--}}this.J=null},di.prototype.O=function(t,e,n,i){return this.i.add(String(t),e,!1,n,i)},di.prototype.P=function(t,e,n,i){return this.i.add(String(t),e,!0,n,i)};var gi=an.JSON.stringify;function mi(){var t=Ii;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var yi=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new vi),(t=>t.reset()));class vi{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function wi(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function Ei(t){an.setTimeout((()=>{throw t}),0)}let bi,Ti=!1,Ii=new class{constructor(){this.h=this.g=null}add(t,e){const n=yi.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},_i=()=>{const t=an.Promise.resolve(void 0);bi=()=>{t.then(Ci)}};var Ci=()=>{for(var t;t=mi();){try{t.h.call(t.g)}catch(t){Ei(t)}var e=yi;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Ti=!1};function Si(t,e){di.call(this),this.h=t||1,this.g=e||an,this.j=pn(this.qb,this),this.l=Date.now()}function Ai(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}function Di(t,e,n){if("function"==typeof t)n&&(t=pn(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=pn(t.handleEvent,t)}return 2147483647<Number(e)?-1:an.setTimeout(t,e||0)}function ki(t){t.g=Di((()=>{t.g=null,t.i&&(t.i=!1,ki(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}mn(Si,di),(nn=Si.prototype).ga=!1,nn.T=null,nn.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),fi(this,"tick"),this.ga&&(Ai(this),this.start()))}},nn.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},nn.N=function(){Si.$.N.call(this),Ai(this),delete this.g};class Ni extends yn{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:ki(this)}N(){super.N(),this.g&&(an.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ri(t){yn.call(this),this.h=t,this.g={}}mn(Ri,yn);var xi=[];function Li(t,e,n,i){Array.isArray(n)||(n&&(xi[0]=n.toString()),n=xi);for(var r=0;r<n.length;r++){var s=ni(e,n[r],i||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}}function Mi(t){Gn(t.g,(function(t,e){this.g.hasOwnProperty(e)&&oi(t)}),t),t.g={}}function Oi(){this.g=!0}function Pi(t,e,n,i){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var i=n[t];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<r.length;o++)r[o]=""}}}return gi(n)}catch(t){return e}}(t,n)+(i?" "+i:"")}))}Ri.prototype.N=function(){Ri.$.N.call(this),Mi(this)},Ri.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Oi.prototype.Ea=function(){this.g=!1},Oi.prototype.info=function(){};var Fi={},Vi=null;function Ui(){return Vi=Vi||new di}function Bi(t){bn.call(this,Fi.Ta,t)}function ji(t){const e=Ui();fi(e,new Bi(e))}function $i(t,e){bn.call(this,Fi.STAT_EVENT,t),this.stat=e}function qi(t){const e=Ui();fi(e,new $i(e,t))}function zi(t,e){bn.call(this,Fi.Ua,t),this.size=e}function Ki(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return an.setTimeout((function(){t()}),e)}Fi.Ta="serverreachability",mn(Bi,bn),Fi.STAT_EVENT="statevent",mn($i,bn),Fi.Ua="timingevent",mn(zi,bn);var Hi={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Gi={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Qi(){}function Wi(t){return t.h||(t.h=t.i())}function Xi(){}Qi.prototype.h=null;var Ji,Yi={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Zi(){bn.call(this,"d")}function tr(){bn.call(this,"c")}function er(){}function nr(t,e,n,i){this.l=t,this.j=e,this.m=n,this.W=i||1,this.U=new Ri(this),this.P=rr,t=Ln?125:void 0,this.V=new Si(t),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new ir}function ir(){this.i=null,this.g="",this.h=!1}mn(Zi,bn),mn(tr,bn),mn(er,Qi),er.prototype.g=function(){return new XMLHttpRequest},er.prototype.i=function(){return{}},Ji=new er;var rr=45e3,sr={},or={};function ar(t,e,n){t.L=1,t.v=Sr(br(e)),t.s=n,t.S=!0,cr(t,null)}function cr(t,e){t.G=Date.now(),dr(t),t.A=br(t.v);var n=t.A,i=t.W;Array.isArray(i)||(i=[String(i)]),Ur(n.i,"t",i),t.C=0,n=t.l.J,t.h=new ir,t.g=Vs(t.l,n?e:null,!t.s),0<t.O&&(t.M=new Ni(pn(t.Pa,t,t.g),t.O)),Li(t.U,t.g,"readystatechange",t.nb),e=t.I?Qn(t.I):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.A,t.u,t.s,e)):(t.u="GET",t.g.ha(t.A,t.u,null,e)),ji(),function(t,e,n,i,r,s){t.info((function(){if(t.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var h=a[c].split("=");if(1<h.length){var u=h[0];h=h[1];var l=u.split("_");o=2<=l.length&&"type"==l[1]?o+(u+"=")+h+"&":o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.u,t.A,t.m,t.W,t.s)}function hr(t){return!!t.g&&"GET"==t.u&&2!=t.L&&t.l.Ha}function ur(t,e,n){let i,r=!0;for(;!t.J&&t.C<n.length;){if(i=lr(t,n),i==or){4==e&&(t.o=4,qi(14),r=!1),Pi(t.j,t.m,null,"[Incomplete Response]");break}if(i==sr){t.o=4,qi(15),Pi(t.j,t.m,n,"[Invalid Chunk]"),r=!1;break}Pi(t.j,t.m,i,null),yr(t,i)}hr(t)&&i!=or&&i!=sr&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,qi(16),r=!1),t.i=t.i&&r,r?0<n.length&&!t.ba&&(t.ba=!0,(e=t.l).g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),Ns(e),e.M=!0,qi(11))):(Pi(t.j,t.m,n,"[Invalid Chunked Response]"),mr(t),gr(t))}function lr(t,e){var n=t.C,i=e.indexOf("\n",n);return-1==i?or:(n=Number(e.substring(n,i)),isNaN(n)?sr:(i+=1)+n>e.length?or:(e=e.slice(i,i+n),t.C=i+n,e))}function dr(t){t.Y=Date.now()+t.P,fr(t,t.P)}function fr(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Ki(pn(t.lb,t),e)}function pr(t){t.B&&(an.clearTimeout(t.B),t.B=null)}function gr(t){0==t.l.H||t.J||Ls(t.l,t)}function mr(t){pr(t);var e=t.M;e&&"function"==typeof e.sa&&e.sa(),t.M=null,Ai(t.V),Mi(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function yr(t,e){try{var n=t.l;if(0!=n.H&&(n.g==t||Kr(n.i,t)))if(!t.K&&Kr(n.i,t)&&3==n.H){try{var i=n.Ja.g.parse(e)}catch(t){i=null}if(Array.isArray(i)&&3==i.length){var r=i;if(0==r[0]){t:if(!n.u){if(n.g){if(!(n.g.G+3e3<t.G))break t;xs(n),Ts(n)}ks(n),qi(18)}}else n.Fa=r[1],0<n.Fa-n.V&&37500>r[2]&&n.G&&0==n.A&&!n.v&&(n.v=Ki(pn(n.ib,n),6e3));if(1>=zr(n.i)&&n.oa){try{n.oa()}catch(t){}n.oa=void 0}}else Os(n,11)}else if((t.K||n.g==t)&&xs(n),!In(e))for(r=n.Ja.g.parse(e),e=0;e<r.length;e++){let h=r[e];if(n.V=h[0],h=h[1],2==n.H)if("c"==h[0]){n.K=h[1],n.pa=h[2];const e=h[3];null!=e&&(n.ra=e,n.l.info("VER="+n.ra));const r=h[4];null!=r&&(n.Ga=r,n.l.info("SVER="+n.Ga));const u=h[5];null!=u&&"number"==typeof u&&0<u&&(i=1.5*u,n.L=i,n.l.info("backChannelRequestTimeoutMs_="+i)),i=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var s=i.i;s.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Hr(s,s.h),s.h=null))}if(i.F){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(i.Da=t,Cr(i.I,i.F,t))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=t;if((i=n).wa=Fs(i,i.J?i.pa:null,i.Y),o.K){Gr(i.i,o);var a=o,c=i.L;c&&a.setTimeout(c),a.B&&(pr(a),dr(a)),i.g=o}else Ds(i);0<n.j.length&&_s(n)}else"stop"!=h[0]&&"close"!=h[0]||Os(n,7);else 3==n.H&&("stop"==h[0]||"close"==h[0]?"stop"==h[0]?Os(n,7):bs(n):"noop"!=h[0]&&n.h&&n.h.Aa(h),n.A=0)}ji()}catch(t){}}function vr(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(cn(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.ta&&"function"==typeof t.ta)return t.ta();if(!t.Z||"function"!=typeof t.Z){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(cn(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const i in t)e[n++]=i;return e}}}(t),i=function(t){if(t.Z&&"function"==typeof t.Z)return t.Z();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(cn(t)){for(var e=[],n=t.length,i=0;i<n;i++)e.push(t[i]);return e}for(i in e=[],n=0,t)e[n++]=t[i];return e}(t),r=i.length,s=0;s<r;s++)e.call(void 0,i[s],n&&n[s],t)}(nn=nr.prototype).setTimeout=function(t){this.P=t},nn.nb=function(t){t=t.target;const e=this.M;e&&3==gs(t)?e.l():this.Pa(t)},nn.Pa=function(t){try{if(t==this.g)t:{const u=gs(this.g);var e=this.g.Ia();if(this.g.da(),!(3>u)&&(3!=u||Ln||this.g&&(this.h.h||this.g.ja()||ms(this.g)))){this.J||4!=u||7==e||ji(),pr(this);var n=this.g.da();this.ca=n;e:if(hr(this)){var i=ms(this.g);t="";var r=i.length,s=4==gs(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){mr(this),gr(this);var o="";break e}this.h.i=new an.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,t+=this.h.i.decode(i[e],{stream:s&&e==r-1});i.splice(0,r),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(t,e,n,i,r,s,o){t.info((function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+e+"\n"+n+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.W,u,n),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!In(a)){var h=a;break e}}h=null}if(!(n=h)){this.i=!1,this.o=3,qi(12),mr(this),gr(this);break t}Pi(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,yr(this,n)}this.S?(ur(this,u,o),Ln&&this.i&&3==u&&(Li(this.U,this.V,"tick",this.mb),this.V.start())):(Pi(this.j,this.m,o,null),yr(this,o)),4==u&&mr(this),this.i&&!this.J&&(4==u?Ls(this.l,this):(this.i=!1,dr(this)))}else(function(t){const e={};t=(t.g&&2<=gs(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<t.length;i++){if(In(t[i]))continue;var n=wi(t[i]);const r=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=e[r]||[];e[r]=s,s.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.o=3,qi(12)):(this.o=0,qi(13)),mr(this),gr(this)}}}catch(t){}},nn.mb=function(){if(this.g){var t=gs(this.g),e=this.g.ja();this.C<e.length&&(pr(this),ur(this,t,e),this.i&&4!=t&&dr(this))}},nn.cancel=function(){this.J=!0,mr(this)},nn.lb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.L&&(ji(),qi(17)),mr(this),this.o=2,gr(this)):fr(this,this.Y-t)};var wr=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Er(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Er){this.h=t.h,Tr(this,t.j),this.s=t.s,this.g=t.g,Ir(this,t.m),this.l=t.l;var e=t.i,n=new Or;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),_r(this,n),this.o=t.o}else t&&(e=String(t).match(wr))?(this.h=!1,Tr(this,e[1]||"",!0),this.s=Ar(e[2]||""),this.g=Ar(e[3]||"",!0),Ir(this,e[4]),this.l=Ar(e[5]||"",!0),_r(this,e[6]||"",!0),this.o=Ar(e[7]||"")):(this.h=!1,this.i=new Or(null,this.h))}function br(t){return new Er(t)}function Tr(t,e,n){t.j=n?Ar(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Ir(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function _r(t,e,n){e instanceof Or?(t.i=e,function(t,e){e&&!t.j&&(Pr(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Fr(this,e),Ur(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=Dr(e,Lr)),t.i=new Or(e,t.h))}function Cr(t,e,n){t.i.set(e,n)}function Sr(t){return Cr(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Ar(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Dr(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,kr),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function kr(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Er.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Dr(e,Nr,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Dr(e,Nr,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(Dr(n,"/"==n.charAt(0)?xr:Rr,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Dr(n,Mr)),t.join("")};var Nr=/[#\/\?@]/g,Rr=/[#\?:]/g,xr=/[#\?]/g,Lr=/[#\?@]/g,Mr=/#/g;function Or(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Pr(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var i=t[n].indexOf("="),r=null;if(0<=i){var s=t[n].substring(0,i);r=t[n].substring(i+1)}else s=t[n];e(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Fr(t,e){Pr(t),e=Br(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Vr(t,e){return Pr(t),e=Br(t,e),t.g.has(e)}function Ur(t,e,n){Fr(t,e),0<n.length&&(t.i=null,t.g.set(Br(t,e),wn(n)),t.h+=n.length)}function Br(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function jr(t){this.l=t||$r,t=an.PerformanceNavigationTiming?0<(t=an.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(an.g&&an.g.Ka&&an.g.Ka()&&an.g.Ka().ec),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(nn=Or.prototype).add=function(t,e){Pr(this),this.i=null,t=Br(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},nn.forEach=function(t,e){Pr(this),this.g.forEach((function(n,i){n.forEach((function(n){t.call(e,n,i,this)}),this)}),this)},nn.ta=function(){Pr(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let i=0;i<e.length;i++){const r=t[i];for(let t=0;t<r.length;t++)n.push(e[i])}return n},nn.Z=function(t){Pr(this);let e=[];if("string"==typeof t)Vr(this,t)&&(e=e.concat(this.g.get(Br(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},nn.set=function(t,e){return Pr(this),this.i=null,Vr(this,t=Br(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},nn.get=function(t,e){return t&&0<(t=this.Z(t)).length?String(t[0]):e},nn.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var i=e[n];const s=encodeURIComponent(String(i)),o=this.Z(i);for(i=0;i<o.length;i++){var r=s;""!==o[i]&&(r+="="+encodeURIComponent(String(o[i]))),t.push(r)}}return this.i=t.join("&")};var $r=10;function qr(t){return!!t.h||!!t.g&&t.g.size>=t.j}function zr(t){return t.h?1:t.g?t.g.size:0}function Kr(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Hr(t,e){t.g?t.g.add(e):t.h=e}function Gr(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Qr(t){if(null!=t.h)return t.i.concat(t.h.F);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return wn(t.i)}jr.prototype.cancel=function(){if(this.i=Qr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var Wr=class{stringify(t){return an.JSON.stringify(t,void 0)}parse(t){return an.JSON.parse(t,void 0)}};function Xr(){this.g=new Wr}function Jr(t,e,n){const i=n||"";try{vr(t,(function(t,n){let r=t;hn(t)&&(r=gi(t)),e.push(i+n+"="+encodeURIComponent(r))}))}catch(t){throw e.push(i+"type="+encodeURIComponent("_badmap")),t}}function Yr(t,e,n,i,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(i)}catch(t){}}function Zr(t){this.l=t.fc||null,this.j=t.ob||!1}function ts(t,e){di.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=es,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}mn(Zr,Qi),Zr.prototype.g=function(){return new ts(this.l,this.j)},Zr.prototype.i=function(t){return function(){return t}}({}),mn(ts,di);var es=0;function ns(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}function is(t){t.readyState=4,t.l=null,t.j=null,t.A=null,rs(t)}function rs(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(nn=ts.prototype).open=function(t,e){if(this.readyState!=es)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,rs(this)},nn.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||an).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},nn.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,is(this)),this.readyState=es},nn.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,rs(this)),this.g&&(this.readyState=3,rs(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==an.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;ns(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))},nn.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?is(this):rs(this),3==this.readyState&&ns(this)}},nn.Za=function(t){this.g&&(this.response=this.responseText=t,is(this))},nn.Ya=function(t){this.g&&(this.response=t,is(this))},nn.ka=function(){this.g&&is(this)},nn.setRequestHeader=function(t,e){this.v.append(t,e)},nn.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},nn.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(ts.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var ss=an.JSON.parse;function os(t){di.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=as,this.L=this.M=!1}mn(os,di);var as="",cs=/^https?$/i,hs=["POST","PUT"];function us(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,ls(t),fs(t)}function ls(t){t.F||(t.F=!0,fi(t,"complete"),fi(t,"error"))}function ds(t){if(t.h&&void 0!==on&&(!t.C[1]||4!=gs(t)||2!=t.da()))if(t.v&&4==gs(t))Di(t.La,0,t);else if(fi(t,"readystatechange"),4==gs(t)){t.h=!1;try{const o=t.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var i;if(i=0===o){var r=String(t.I).match(wr)[1]||null;!r&&an.self&&an.self.location&&(r=an.self.location.protocol.slice(0,-1)),i=!cs.test(r?r.toLowerCase():"")}n=i}if(n)fi(t,"complete"),fi(t,"success");else{t.m=6;try{var s=2<gs(t)?t.g.statusText:""}catch(t){s=""}t.j=s+" ["+t.da()+"]",ls(t)}}finally{fs(t)}}}function fs(t,e){if(t.g){ps(t);const n=t.g,i=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||fi(t,"ready");try{n.onreadystatechange=i}catch(t){}}}function ps(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(an.clearTimeout(t.A),t.A=null)}function gs(t){return t.g?t.g.readyState:0}function ms(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case as:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function ys(t){let e="";return Gn(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function vs(t,e,n){t:{for(i in n){var i=!1;break t}i=!0}i||(n=ys(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Cr(t,e,n))}function ws(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Es(t){this.Ga=0,this.j=[],this.l=new Oi,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=ws("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=ws("baseRetryDelayMs",5e3,t),this.hb=ws("retryDelaySeedMs",1e4,t),this.eb=ws("forwardChannelMaxRetries",2,t),this.xa=ws("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.dc||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new jr(t&&t.concurrentRequestLimit),this.Ja=new Xr,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function bs(t){if(Is(t),3==t.H){var e=t.W++,n=br(t.I);if(Cr(n,"SID",t.K),Cr(n,"RID",e),Cr(n,"TYPE","terminate"),Ss(t,n),(e=new nr(t,t.l,e)).L=2,e.v=Sr(br(n)),n=!1,an.navigator&&an.navigator.sendBeacon)try{n=an.navigator.sendBeacon(e.v.toString(),"")}catch(t){}!n&&an.Image&&((new Image).src=e.v,n=!0),n||(e.g=Vs(e.l,null),e.g.ha(e.v)),e.G=Date.now(),dr(e)}Ps(t)}function Ts(t){t.g&&(Ns(t),t.g.cancel(),t.g=null)}function Is(t){Ts(t),t.u&&(an.clearTimeout(t.u),t.u=null),xs(t),t.i.cancel(),t.m&&("number"==typeof t.m&&an.clearTimeout(t.m),t.m=null)}function _s(t){if(!qr(t.i)&&!t.m){t.m=!0;var e=t.Na;bi||_i(),Ti||(bi(),Ti=!0),Ii.add(e,t),t.C=0}}function Cs(t,e){var n;n=e?e.m:t.W++;const i=br(t.I);Cr(i,"SID",t.K),Cr(i,"RID",n),Cr(i,"AID",t.V),Ss(t,i),t.o&&t.s&&vs(i,t.o,t.s),n=new nr(t,t.l,n,t.C+1),null===t.o&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=As(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),Hr(t.i,n),ar(n,i,e)}function Ss(t,e){t.na&&Gn(t.na,(function(t,n){Cr(e,n,t)})),t.h&&vr({},(function(t,n){Cr(e,n,t)}))}function As(t,e,n){n=Math.min(t.j.length,n);var i=t.h?pn(t.h.Va,t.h,t):null;t:{var r=t.j;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=r[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let s=!0;for(let o=0;o<n;o++){let n=r[o].g;const a=r[o].map;if(n-=e,0>n)e=Math.max(0,r[o].g-100),s=!1;else try{Jr(a,t,"req"+n+"_")}catch(t){i&&i(a)}}if(s){i=t.join("&");break t}}}return t=t.j.splice(0,n),e.F=t,i}function Ds(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;bi||_i(),Ti||(bi(),Ti=!0),Ii.add(e,t),t.A=0}}function ks(t){return!(t.g||t.u||3<=t.A||(t.ba++,t.u=Ki(pn(t.Ma,t),Ms(t,t.A)),t.A++,0))}function Ns(t){null!=t.B&&(an.clearTimeout(t.B),t.B=null)}function Rs(t){t.g=new nr(t,t.l,"rpc",t.ba),null===t.o&&(t.g.I=t.s),t.g.O=0;var e=br(t.wa);Cr(e,"RID","rpc"),Cr(e,"SID",t.K),Cr(e,"AID",t.V),Cr(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&Cr(e,"TO",t.qa),Cr(e,"TYPE","xmlhttp"),Ss(t,e),t.o&&t.s&&vs(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.v=Sr(br(e)),n.s=null,n.S=!0,cr(n,t)}function xs(t){null!=t.v&&(an.clearTimeout(t.v),t.v=null)}function Ls(t,e){var n=null;if(t.g==e){xs(t),Ns(t),t.g=null;var i=2}else{if(!Kr(t.i,e))return;n=e.F,Gr(t.i,e),i=1}if(0!=t.H)if(e.i)if(1==i){n=e.s?e.s.length:0,e=Date.now()-e.G;var r=t.C;fi(i=Ui(),new zi(i,n)),_s(t)}else Ds(t);else if(3==(r=e.o)||0==r&&0<e.ca||!(1==i&&function(t,e){return!(zr(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.j=e.F.concat(t.j),0):1==t.H||2==t.H||t.C>=(t.cb?0:t.eb)||(t.m=Ki(pn(t.Na,t,e),Ms(t,t.C)),t.C++,0)))}(t,e)||2==i&&ks(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),r){case 1:Os(t,5);break;case 4:Os(t,10);break;case 3:Os(t,6);break;default:Os(t,2)}}function Ms(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function Os(t,e){if(t.l.info("Error code "+e),2==e){var n=null;t.h&&(n=null);var i=pn(t.pb,t);n||(n=new Er("//www.google.com/images/cleardot.gif"),an.location&&"http"==an.location.protocol||Tr(n,"https"),Sr(n)),function(t,e){const n=new Oi;if(an.Image){const i=new Image;i.onload=gn(Yr,n,i,"TestLoadImage: loaded",!0,e),i.onerror=gn(Yr,n,i,"TestLoadImage: error",!1,e),i.onabort=gn(Yr,n,i,"TestLoadImage: abort",!1,e),i.ontimeout=gn(Yr,n,i,"TestLoadImage: timeout",!1,e),an.setTimeout((function(){i.ontimeout&&i.ontimeout()}),1e4),i.src=t}else e(!1)}(n.toString(),i)}else qi(2);t.H=0,t.h&&t.h.za(e),Ps(t),Is(t)}function Ps(t){if(t.H=0,t.ma=[],t.h){const e=Qr(t.i);0==e.length&&0==t.j.length||(En(t.ma,e),En(t.ma,t.j),t.i.i.length=0,wn(t.j),t.j.length=0),t.h.ya()}}function Fs(t,e,n){var i=n instanceof Er?br(n):new Er(n);if(""!=i.g)e&&(i.g=e+"."+i.g),Ir(i,i.m);else{var r=an.location;i=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;var s=new Er(null);i&&Tr(s,i),e&&(s.g=e),r&&Ir(s,r),n&&(s.l=n),i=s}return n=t.F,e=t.Da,n&&e&&Cr(i,n,e),Cr(i,"VER",t.ra),Ss(t,i),i}function Vs(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ha&&!t.va?new os(new Zr({ob:!0})):new os(t.va)).Oa(t.J),e}function Us(){}function Bs(){if(Rn&&!(10<=Number(Bn)))throw Error("Environmental error: no available transport.")}function js(t,e){di.call(this),this.g=new Es(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!In(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!In(e)&&(this.g.F=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new zs(this)}function $s(t){Zi.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function qs(){tr.call(this),this.status=1}function zs(t){this.g=t}function Ks(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Hs(t,e,n){n||(n=0);var i=Array(16);if("string"==typeof e)for(var r=0;16>r;++r)i[r]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(r=0;16>r;++r)i[r]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],r=t.g[2];var s=t.g[3],o=e+(s^n&(r^s))+i[0]+3614090360&4294967295;o=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=n+(o<<7&4294967295|o>>>25))+((o=s+(r^e&(n^r))+i[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(e^n))+i[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^r&(s^e))+i[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(r^s))+i[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^e&(n^r))+i[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(e^n))+i[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^r&(s^e))+i[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(r^s))+i[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^e&(n^r))+i[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(e^n))+i[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^r&(s^e))+i[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(r^s))+i[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^e&(n^r))+i[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(e^n))+i[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^r&(s^e))+i[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(r^s&(n^r))+i[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(e^n))+i[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^n&(s^e))+i[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(r^s))+i[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^s&(n^r))+i[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(e^n))+i[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^n&(s^e))+i[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(r^s))+i[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^s&(n^r))+i[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(e^n))+i[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^n&(s^e))+i[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(r^s))+i[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^s&(n^r))+i[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(e^n))+i[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^n&(s^e))+i[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(r^s))+i[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^r^s)+i[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^r)+i[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^n)+i[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^e)+i[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^r^s)+i[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^r)+i[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^n)+i[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^e)+i[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^r^s)+i[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^r)+i[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^n)+i[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^e)+i[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^r^s)+i[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^r)+i[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^n)+i[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^e)+i[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(r^(n|~s))+i[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~r))+i[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(s|~n))+i[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(r|~e))+i[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(r^(n|~s))+i[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~r))+i[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(s|~n))+i[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(r|~e))+i[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(r^(n|~s))+i[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~r))+i[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(s|~n))+i[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(r|~e))+i[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=n+((o=e+(r^(n|~s))+i[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~r))+i[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((r=s+((o=r+(e^(s|~n))+i[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+i[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(r+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+r&4294967295,t.g[3]=t.g[3]+s&4294967295}function Gs(t,e){this.h=e;for(var n=[],i=!0,r=t.length-1;0<=r;r--){var s=0|t[r];i&&s==e||(n[r]=s,i=!1)}this.g=n}(nn=os.prototype).Oa=function(t){this.M=t},nn.ha=function(t,e,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Ji.g(),this.C=this.u?Wi(this.u):Wi(Ji),this.g.onreadystatechange=pn(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(t){return void us(this,t)}if(t=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var r in i)n.set(r,i[r]);else{if("function"!=typeof i.keys||"function"!=typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const t of i.keys())n.set(t,i.get(t))}i=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),r=an.FormData&&t instanceof an.FormData,!(0<=vn(hs,e))||i||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{ps(this),0<this.B&&((this.L=function(t){return Rn&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=pn(this.ua,this)):this.A=Di(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){us(this,t)}},nn.ua=function(){void 0!==on&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,fi(this,"timeout"),this.abort(8))},nn.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,fi(this,"complete"),fi(this,"abort"),fs(this))},nn.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),fs(this,!0)),os.$.N.call(this)},nn.La=function(){this.s||(this.G||this.v||this.l?ds(this):this.kb())},nn.kb=function(){ds(this)},nn.isActive=function(){return!!this.g},nn.da=function(){try{return 2<gs(this)?this.g.status:-1}catch(t){return-1}},nn.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},nn.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),ss(e)}},nn.Ia=function(){return this.m},nn.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(nn=Es.prototype).ra=8,nn.H=1,nn.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const r=new nr(this,this.l,t);let s=this.s;if(this.U&&(s?(s=Qn(s),Xn(s,this.U)):s=this.U),null!==this.o||this.O||(r.I=s,s=null),this.P)t:{for(var e=0,n=0;n<this.j.length;n++){var i=this.j[n];if(void 0===(i="__data__"in i.map&&"string"==typeof(i=i.map.__data__)?i.length:void 0))break;if(4096<(e+=i)){e=n;break t}if(4096===e||n===this.j.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=As(this,r,e),Cr(n=br(this.I),"RID",t),Cr(n,"CVER",22),this.F&&Cr(n,"X-HTTP-Session-Id",this.F),Ss(this,n),s&&(this.O?e="headers="+encodeURIComponent(String(ys(s)))+"&"+e:this.o&&vs(n,this.o,s)),Hr(this.i,r),this.bb&&Cr(n,"TYPE","init"),this.P?(Cr(n,"$req",e),Cr(n,"SID","null"),r.aa=!0,ar(r,n,null)):ar(r,n,e),this.H=2}}else 3==this.H&&(t?Cs(this,t):0==this.j.length||qr(this.i)||Cs(this))},nn.Ma=function(){if(this.u=null,Rs(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=Ki(pn(this.jb,this),t)}},nn.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,qi(10),Ts(this),Rs(this))},nn.ib=function(){null!=this.v&&(this.v=null,Ts(this),ks(this),qi(19))},nn.pb=function(t){t?(this.l.info("Successfully pinged google.com"),qi(2)):(this.l.info("Failed to ping google.com"),qi(1))},nn.isActive=function(){return!!this.h&&this.h.isActive(this)},(nn=Us.prototype).Ba=function(){},nn.Aa=function(){},nn.za=function(){},nn.ya=function(){},nn.isActive=function(){return!0},nn.Va=function(){},Bs.prototype.g=function(t,e){return new js(t,e)},mn(js,di),js.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;qi(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=Fs(t,null,t.Y),_s(t)},js.prototype.close=function(){bs(this.g)},js.prototype.u=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=gi(t),t=n);e.j.push(new class{constructor(t,e){this.g=t,this.map=e}}(e.fb++,t)),3==e.H&&_s(e)},js.prototype.N=function(){this.g.h=null,delete this.j,bs(this.g),delete this.g,js.$.N.call(this)},mn($s,Zi),mn(qs,tr),mn(zs,Us),zs.prototype.Ba=function(){fi(this.g,"a")},zs.prototype.Aa=function(t){fi(this.g,new $s(t))},zs.prototype.za=function(t){fi(this.g,new qs)},zs.prototype.ya=function(){fi(this.g,"b")},mn(Ks,(function(){this.blockSize=-1})),Ks.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Ks.prototype.j=function(t,e){void 0===e&&(e=t.length);for(var n=e-this.blockSize,i=this.m,r=this.h,s=0;s<e;){if(0==r)for(;s<=n;)Hs(this,t,s),s+=this.blockSize;if("string"==typeof t){for(;s<e;)if(i[r++]=t.charCodeAt(s++),r==this.blockSize){Hs(this,i),r=0;break}}else for(;s<e;)if(i[r++]=t[s++],r==this.blockSize){Hs(this,i),r=0;break}}this.h=r,this.i+=e},Ks.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var i=0;32>i;i+=8)t[n++]=this.g[e]>>>i&255;return t};var Qs={};function Ws(t){return-128<=t&&128>t?function(t,e){var n=Qs;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=function(t){return new Gs([0|t],0>t?-1:0)}(t)}(t):new Gs([0|t],0>t?-1:0)}function Xs(t){if(isNaN(t)||!isFinite(t))return Ys;if(0>t)return io(Xs(-t));for(var e=[],n=1,i=0;t>=n;i++)e[i]=t/n|0,n*=Js;return new Gs(e,0)}var Js=4294967296,Ys=Ws(0),Zs=Ws(1),to=Ws(16777216);function eo(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function no(t){return-1==t.h}function io(t){for(var e=t.g.length,n=[],i=0;i<e;i++)n[i]=~t.g[i];return new Gs(n,~t.h).add(Zs)}function ro(t,e){return t.add(io(e))}function so(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function oo(t,e){this.g=t,this.h=e}function ao(t,e){if(eo(e))throw Error("division by zero");if(eo(t))return new oo(Ys,Ys);if(no(t))return e=ao(io(t),e),new oo(io(e.g),io(e.h));if(no(e))return e=ao(t,io(e)),new oo(io(e.g),e.h);if(30<t.g.length){if(no(t)||no(e))throw Error("slowDivide_ only works with positive integers.");for(var n=Zs,i=e;0>=i.X(t);)n=co(n),i=co(i);var r=ho(n,1),s=ho(i,1);for(i=ho(i,2),n=ho(n,2);!eo(i);){var o=s.add(i);0>=o.X(t)&&(r=r.add(n),s=o),i=ho(i,1),n=ho(n,1)}return e=ro(t,r.R(e)),new oo(r,e)}for(r=Ys;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),i=48>=(i=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,i-48),o=(s=Xs(n)).R(e);no(o)||0<o.X(t);)o=(s=Xs(n-=i)).R(e);eo(s)&&(s=Zs),r=r.add(s),t=ro(t,o)}return new oo(r,t)}function co(t){for(var e=t.g.length+1,n=[],i=0;i<e;i++)n[i]=t.D(i)<<1|t.D(i-1)>>>31;return new Gs(n,t.h)}function ho(t,e){var n=e>>5;e%=32;for(var i=t.g.length-n,r=[],s=0;s<i;s++)r[s]=0<e?t.D(s+n)>>>e|t.D(s+n+1)<<32-e:t.D(s+n);return new Gs(r,t.h)}(nn=Gs.prototype).ea=function(){if(no(this))return-io(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var i=this.D(n);t+=(0<=i?i:Js+i)*e,e*=Js}return t},nn.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(eo(this))return"0";if(no(this))return"-"+io(this).toString(t);for(var e=Xs(Math.pow(t,6)),n=this,i="";;){var r=ao(n,e).g,s=((0<(n=ro(n,r.R(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(eo(n=r))return s+i;for(;6>s.length;)s="0"+s;i=s+i}},nn.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},nn.X=function(t){return no(t=ro(this,t))?-1:eo(t)?0:1},nn.abs=function(){return no(this)?io(this):this},nn.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0,r=0;r<=e;r++){var s=i+(65535&this.D(r))+(65535&t.D(r)),o=(s>>>16)+(this.D(r)>>>16)+(t.D(r)>>>16);i=o>>>16,s&=65535,o&=65535,n[r]=o<<16|s}return new Gs(n,-2147483648&n[n.length-1]?-1:0)},nn.R=function(t){if(eo(this)||eo(t))return Ys;if(no(this))return no(t)?io(this).R(io(t)):io(io(this).R(t));if(no(t))return io(this.R(io(t)));if(0>this.X(to)&&0>t.X(to))return Xs(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],i=0;i<2*e;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var r=0;r<t.g.length;r++){var s=this.D(i)>>>16,o=65535&this.D(i),a=t.D(r)>>>16,c=65535&t.D(r);n[2*i+2*r]+=o*c,so(n,2*i+2*r),n[2*i+2*r+1]+=s*c,so(n,2*i+2*r+1),n[2*i+2*r+1]+=o*a,so(n,2*i+2*r+1),n[2*i+2*r+2]+=s*a,so(n,2*i+2*r+2)}for(i=0;i<e;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=e;i<2*e;i++)n[i]=0;return new Gs(n,0)},nn.gb=function(t){return ao(this,t).h},nn.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.D(i)&t.D(i);return new Gs(n,this.h&t.h)},nn.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.D(i)|t.D(i);return new Gs(n,this.h|t.h)},nn.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.D(i)^t.D(i);return new Gs(n,this.h^t.h)},Bs.prototype.createWebChannel=Bs.prototype.g,js.prototype.send=js.prototype.u,js.prototype.open=js.prototype.m,js.prototype.close=js.prototype.close,Hi.NO_ERROR=0,Hi.TIMEOUT=8,Hi.HTTP_ERROR=6,Gi.COMPLETE="complete",Xi.EventType=Yi,Yi.OPEN="a",Yi.CLOSE="b",Yi.ERROR="c",Yi.MESSAGE="d",di.prototype.listen=di.prototype.O,os.prototype.listenOnce=os.prototype.P,os.prototype.getLastError=os.prototype.Sa,os.prototype.getLastErrorCode=os.prototype.Ia,os.prototype.getStatus=os.prototype.da,os.prototype.getResponseJson=os.prototype.Wa,os.prototype.getResponseText=os.prototype.ja,os.prototype.send=os.prototype.ha,os.prototype.setWithCredentials=os.prototype.Oa,Ks.prototype.digest=Ks.prototype.l,Ks.prototype.reset=Ks.prototype.reset,Ks.prototype.update=Ks.prototype.j,Gs.prototype.add=Gs.prototype.add,Gs.prototype.multiply=Gs.prototype.R,Gs.prototype.modulo=Gs.prototype.gb,Gs.prototype.compare=Gs.prototype.X,Gs.prototype.toNumber=Gs.prototype.ea,Gs.prototype.toString=Gs.prototype.toString,Gs.prototype.getBits=Gs.prototype.D,Gs.fromNumber=Xs,Gs.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return io(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var i=Xs(Math.pow(n,8)),r=Ys,s=0;s<e.length;s+=8){var o=Math.min(8,e.length-s),a=parseInt(e.substring(s,s+o),n);8>o?(o=Xs(Math.pow(n,o)),r=r.R(o).add(Xs(a))):r=(r=r.R(i)).add(Xs(a))}return r};var uo=sn.createWebChannelTransport=function(){return new Bs},lo=sn.getStatEventTarget=function(){return Ui()},fo=sn.ErrorCode=Hi,po=sn.EventType=Gi,go=sn.Event=Fi,mo=sn.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},yo=sn.FetchXmlHttpFactory=Zr,vo=sn.WebChannel=Xi,wo=sn.XhrIo=os,Eo=sn.Md5=Ks,bo=sn.Integer=Gs;const To="@firebase/firestore";class Io{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Io.UNAUTHENTICATED=new Io(null),Io.GOOGLE_CREDENTIALS=new Io("google-credentials-uid"),Io.FIRST_PARTY=new Io("first-party-uid"),Io.MOCK_USER=new Io("mock-user");let _o="10.1.0";const Co=new x("@firebase/firestore");function So(){return Co.logLevel}function Ao(t,...e){if(Co.logLevel<=S.DEBUG){const n=e.map(No);Co.debug(`Firestore (${_o}): ${t}`,...n)}}function Do(t,...e){if(Co.logLevel<=S.ERROR){const n=e.map(No);Co.error(`Firestore (${_o}): ${t}`,...n)}}function ko(t,...e){if(Co.logLevel<=S.WARN){const n=e.map(No);Co.warn(`Firestore (${_o}): ${t}`,...n)}}function No(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function Ro(t="Unexpected state"){const e=`FIRESTORE (${_o}) INTERNAL ASSERTION FAILED: `+t;throw Do(e),new Error(e)}function xo(t,e){t||Ro()}function Lo(t,e){return t}const Mo={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Oo extends u{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Po{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Fo{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Vo{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Io.UNAUTHENTICATED)))}shutdown(){}}class Uo{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class Bo{constructor(t){this.t=t,this.currentUser=Io.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const i=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let r=new Po;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new Po,t.enqueueRetryable((()=>i(this.currentUser)))};const s=()=>{const e=r;t.enqueueRetryable((async()=>{await e.promise,await i(this.currentUser)}))},o=t=>{Ao("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(Ao("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new Po)}}),0),s()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(Ao("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(xo("string"==typeof e.accessToken),new Fo(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return xo(null===t||"string"==typeof t),new Io(t)}}class jo{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=Io.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class $o{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new jo(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable((()=>e(Io.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class qo{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class zo{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){const n=t=>{null!=t.error&&Ao("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.R;return this.R=t.token,Ao("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const i=t=>{Ao("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.A.onInit((t=>i(t))),setTimeout((()=>{if(!this.appCheck){const t=this.A.getImmediate({optional:!0});t?i(t):Ao("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(xo("string"==typeof t.token),this.R=t.token,new qo(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Ko(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class Ho{static V(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=Ko(40);for(let i=0;i<n.length;++i)e.length<20&&n[i]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[i]%62))}return e}}function Go(t,e){return t<e?-1:t>e?1:0}function Qo(t,e,n){return t.length===e.length&&t.every(((t,i)=>n(t,e[i])))}class Wo{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Oo(Mo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Oo(Mo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Oo(Mo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Oo(Mo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Wo.fromMillis(Date.now())}static fromDate(t){return Wo.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new Wo(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?Go(this.nanoseconds,t.nanoseconds):Go(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Xo{constructor(t){this.timestamp=t}static fromTimestamp(t){return new Xo(t)}static min(){return new Xo(new Wo(0,0))}static max(){return new Xo(new Wo(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Jo{constructor(t,e,n){void 0===e?e=0:e>t.length&&Ro(),void 0===n?n=t.length-e:n>t.length-e&&Ro(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===Jo.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Jo?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let i=0;i<n;i++){const n=t.get(i),r=e.get(i);if(n<r)return-1;if(n>r)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Yo extends Jo{construct(t,e,n){return new Yo(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Oo(Mo.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new Yo(e)}static emptyPath(){return new Yo([])}}const Zo=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ta extends Jo{construct(t,e,n){return new ta(t,e,n)}static isValidIdentifier(t){return Zo.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ta.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ta(["__name__"])}static fromServerFormat(t){const e=[];let n="",i=0;const r=()=>{if(0===n.length)throw new Oo(Mo.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let s=!1;for(;i<t.length;){const e=t[i];if("\\"===e){if(i+1===t.length)throw new Oo(Mo.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[i+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Oo(Mo.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,i+=2}else"`"===e?(s=!s,i++):"."!==e||s?(n+=e,i++):(r(),i++)}if(r(),s)throw new Oo(Mo.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ta(e)}static emptyPath(){return new ta([])}}class ea{constructor(t){this.path=t}static fromPath(t){return new ea(Yo.fromString(t))}static fromName(t){return new ea(Yo.fromString(t).popFirst(5))}static empty(){return new ea(Yo.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===Yo.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return Yo.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new ea(new Yo(t.slice()))}}function na(t){return new ia(t.readTime,t.key,-1)}class ia{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new ia(Xo.min(),ea.empty(),-1)}static max(){return new ia(Xo.max(),ea.empty(),-1)}}function ra(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=ea.comparator(t.documentKey,e.documentKey),0!==n?n:Go(t.largestBatchId,e.largestBatchId))}const sa="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class oa{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function aa(t){if(t.code!==Mo.FAILED_PRECONDITION||t.message!==sa)throw t;Ao("LocalStore","Unexpectedly lost primary lease")}class ca{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Ro(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new ca(((n,i)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,i)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,i)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof ca?e:ca.resolve(e)}catch(t){return ca.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):ca.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):ca.reject(e)}static resolve(t){return new ca(((e,n)=>{e(t)}))}static reject(t){return new ca(((e,n)=>{n(t)}))}static waitFor(t){return new ca(((e,n)=>{let i=0,r=0,s=!1;t.forEach((t=>{++i,t.next((()=>{++r,s&&r===i&&e()}),(t=>n(t)))})),s=!0,r===i&&e()}))}static or(t){let e=ca.resolve(!1);for(const n of t)e=e.next((t=>t?ca.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,i)=>{n.push(e.call(this,t,i))})),this.waitFor(n)}static mapArray(t,e){return new ca(((n,i)=>{const r=t.length,s=new Array(r);let o=0;for(let a=0;a<r;a++){const c=a;e(t[c]).next((t=>{s[c]=t,++o,o===r&&n(s)}),(t=>i(t)))}}))}static doWhile(t,e){return new ca(((n,i)=>{const r=()=>{!0===t()?e().next((()=>{r()}),i):n()};r()}))}}function ha(t){return"IndexedDbTransactionError"===t.name}class ua{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.oe(t),this._e=t=>e.writeSequenceNumber(t))}oe(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this._e&&this._e(t),t}}function la(t){return null==t}function da(t){return 0===t&&1/t==-1/0}ua.ae=-1;function fa(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function pa(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}class ga{constructor(t,e){this.comparator=t,this.root=e||ya.EMPTY}insert(t,e){return new ga(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,ya.BLACK,null,null))}remove(t){return new ga(this.comparator,this.root.remove(t,this.comparator).copy(null,null,ya.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(t,n.key);if(0===i)return e+n.left.size;i<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new ma(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new ma(this.root,t,this.comparator,!1)}getReverseIterator(){return new ma(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new ma(this.root,t,this.comparator,!0)}}class ma{constructor(t,e,n,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!t.isEmpty();)if(r=e?n(t.key,e):1,e&&i&&(r*=-1),r<0)t=this.isReverse?t.left:t.right;else{if(0===r){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class ya{constructor(t,e,n,i,r){this.key=t,this.value=e,this.color=null!=n?n:ya.RED,this.left=null!=i?i:ya.EMPTY,this.right=null!=r?r:ya.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,i,r){return new ya(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this;const r=n(t,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===r?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return ya.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===e(t,i.key)){if(i.right.isEmpty())return ya.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,ya.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,ya.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ro();if(this.right.isRed())throw Ro();const t=this.left.check();if(t!==this.right.check())throw Ro();return t+(this.isRed()?0:1)}}ya.EMPTY=null,ya.RED=!0,ya.BLACK=!1,ya.EMPTY=new class{constructor(){this.size=0}get key(){throw Ro()}get value(){throw Ro()}get color(){throw Ro()}get left(){throw Ro()}get right(){throw Ro()}copy(t,e,n,i,r){return this}insert(t,e,n){return new ya(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class va{constructor(t){this.comparator=t,this.data=new ga(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new wa(this.data.getIterator())}getIteratorFrom(t){return new wa(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof va))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(t,i))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new va(this.comparator);return e.data=t,e}}class wa{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ea{constructor(t){this.fields=t,t.sort(ta.comparator)}static empty(){return new Ea([])}unionWith(t){let e=new va(ta.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new Ea(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Qo(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class ba extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ta{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new ba("Invalid base64 string: "+t):t}}(t);return new Ta(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Ta(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Go(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Ta.EMPTY_BYTE_STRING=new Ta("");const Ia=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function _a(t){if(xo(!!t),"string"==typeof t){let e=0;const n=Ia.exec(t);if(xo(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Ca(t.seconds),nanos:Ca(t.nanos)}}function Ca(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Sa(t){return"string"==typeof t?Ta.fromBase64String(t):Ta.fromUint8Array(t)}function Aa(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Da(t){const e=t.mapValue.fields.__previous_value__;return Aa(e)?Da(e):e}function ka(t){const e=_a(t.mapValue.fields.__local_write_time__.timestampValue);return new Wo(e.seconds,e.nanos)}class Na{constructor(t,e,n,i,r,s,o,a,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=i,this.ssl=r,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class Ra{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new Ra("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof Ra&&t.projectId===this.projectId&&t.database===this.database}}const xa={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function La(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Aa(t)?4:Ha(t)?9007199254740991:10:Ro()}function Ma(t,e){if(t===e)return!0;const n=La(t);if(n!==La(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return ka(t).isEqual(ka(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=_a(t.timestampValue),i=_a(e.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Sa(t.bytesValue).isEqual(Sa(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Ca(t.geoPointValue.latitude)===Ca(e.geoPointValue.latitude)&&Ca(t.geoPointValue.longitude)===Ca(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Ca(t.integerValue)===Ca(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Ca(t.doubleValue),i=Ca(e.doubleValue);return n===i?da(n)===da(i):isNaN(n)&&isNaN(i)}return!1}(t,e);case 9:return Qo(t.arrayValue.values||[],e.arrayValue.values||[],Ma);case 10:return function(t,e){const n=t.mapValue.fields||{},i=e.mapValue.fields||{};if(fa(n)!==fa(i))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===i[t]||!Ma(n[t],i[t])))return!1;return!0}(t,e);default:return Ro()}}function Oa(t,e){return void 0!==(t.values||[]).find((t=>Ma(t,e)))}function Pa(t,e){if(t===e)return 0;const n=La(t),i=La(e);if(n!==i)return Go(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return Go(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Ca(t.integerValue||t.doubleValue),i=Ca(e.integerValue||e.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(t,e);case 3:return Fa(t.timestampValue,e.timestampValue);case 4:return Fa(ka(t),ka(e));case 5:return Go(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Sa(t),i=Sa(e);return n.compareTo(i)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),i=e.split("/");for(let t=0;t<n.length&&t<i.length;t++){const e=Go(n[t],i[t]);if(0!==e)return e}return Go(n.length,i.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Go(Ca(t.latitude),Ca(e.latitude));return 0!==n?n:Go(Ca(t.longitude),Ca(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],i=e.values||[];for(let t=0;t<n.length&&t<i.length;++t){const e=Pa(n[t],i[t]);if(e)return e}return Go(n.length,i.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===xa.mapValue&&e===xa.mapValue)return 0;if(t===xa.mapValue)return 1;if(e===xa.mapValue)return-1;const n=t.fields||{},i=Object.keys(n),r=e.fields||{},s=Object.keys(r);i.sort(),s.sort();for(let t=0;t<i.length&&t<s.length;++t){const e=Go(i[t],s[t]);if(0!==e)return e;const o=Pa(n[i[t]],r[s[t]]);if(0!==o)return o}return Go(i.length,s.length)}(t.mapValue,e.mapValue);default:throw Ro()}}function Fa(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Go(t,e);const n=_a(t),i=_a(e),r=Go(n.seconds,i.seconds);return 0!==r?r:Go(n.nanos,i.nanos)}function Va(t){return Ua(t)}function Ua(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=_a(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return Sa(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return ea.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const i of t.values||[])n?n=!1:e+=",",e+=Ua(i);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",i=!0;for(const r of e)i?i=!1:n+=",",n+=`${r}:${Ua(t.fields[r])}`;return n+"}"}(t.mapValue):Ro()}function Ba(t){return!!t&&"integerValue"in t}function ja(t){return!!t&&"arrayValue"in t}function $a(t){return!!t&&"nullValue"in t}function qa(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function za(t){return!!t&&"mapValue"in t}function Ka(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return pa(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Ka(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Ka(t.arrayValue.values[n]);return e}return Object.assign({},t)}function Ha(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class Ga{constructor(t){this.value=t}static empty(){return new Ga({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!za(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Ka(e)}setAll(t){let e=ta.emptyPath(),n={},i=[];t.forEach(((t,r)=>{if(!e.isImmediateParentOf(r)){const t=this.getFieldsMap(e);this.applyChanges(t,n,i),n={},i=[],e=r.popLast()}t?n[r.lastSegment()]=Ka(t):i.push(r.lastSegment())}));const r=this.getFieldsMap(e);this.applyChanges(r,n,i)}delete(t){const e=this.field(t.popLast());za(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ma(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let i=e.mapValue.fields[t.get(n)];za(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,n){pa(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new Ga(Ka(this.value))}}class Qa{constructor(t,e,n,i,r,s,o){this.key=t,this.documentType=e,this.version=n,this.readTime=i,this.createTime=r,this.data=s,this.documentState=o}static newInvalidDocument(t){return new Qa(t,0,Xo.min(),Xo.min(),Xo.min(),Ga.empty(),0)}static newFoundDocument(t,e,n,i){return new Qa(t,1,e,Xo.min(),n,i,0)}static newNoDocument(t,e){return new Qa(t,2,e,Xo.min(),Xo.min(),Ga.empty(),0)}static newUnknownDocument(t,e){return new Qa(t,3,e,Xo.min(),Xo.min(),Ga.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(Xo.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Ga.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Ga.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Xo.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof Qa&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Qa(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Wa{constructor(t,e){this.position=t,this.inclusive=e}}function Xa(t,e,n){let i=0;for(let r=0;r<t.position.length;r++){const s=e[r],o=t.position[r];if(i=s.field.isKeyField()?ea.comparator(ea.fromName(o.referenceValue),n.key):Pa(o,n.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return i}function Ja(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ma(t.position[n],e.position[n]))return!1;return!0}class Ya{constructor(t,e="asc"){this.field=t,this.dir=e}}function Za(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class tc{}class ec extends tc{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new cc(t,e,n):"array-contains"===e?new dc(t,n):"in"===e?new fc(t,n):"not-in"===e?new pc(t,n):"array-contains-any"===e?new gc(t,n):new ec(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new hc(t,n):new uc(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(Pa(e,this.value)):null!==e&&La(this.value)===La(e)&&this.matchesComparison(Pa(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Ro()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class nc extends tc{constructor(t,e){super(),this.filters=t,this.op=e,this.ce=null}static create(t,e){return new nc(t,e)}matches(t){return ic(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.ce||(this.ce=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.ce}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const t=this.le((t=>t.isInequality()));return null!==t?t.field:null}le(t){for(const e of this.getFlattenedFilters())if(t(e))return e;return null}}function ic(t){return"and"===t.op}function rc(t){return function(t){for(const e of t.filters)if(e instanceof nc)return!1;return!0}(t)&&ic(t)}function sc(t){if(t instanceof ec)return t.field.canonicalString()+t.op.toString()+Va(t.value);if(rc(t))return t.filters.map((t=>sc(t))).join(",");{const e=t.filters.map((t=>sc(t))).join(",");return`${t.op}(${e})`}}function oc(t,e){return t instanceof ec?function(t,e){return e instanceof ec&&t.op===e.op&&t.field.isEqual(e.field)&&Ma(t.value,e.value)}(t,e):t instanceof nc?function(t,e){return e instanceof nc&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,i)=>t&&oc(n,e.filters[i])),!0)}(t,e):void Ro()}function ac(t){return t instanceof ec?function(t){return`${t.field.canonicalString()} ${t.op} ${Va(t.value)}`}(t):t instanceof nc?function(t){return t.op.toString()+" {"+t.getFilters().map(ac).join(" ,")+"}"}(t):"Filter"}class cc extends ec{constructor(t,e,n){super(t,e,n),this.key=ea.fromName(n.referenceValue)}matches(t){const e=ea.comparator(t.key,this.key);return this.matchesComparison(e)}}class hc extends ec{constructor(t,e){super(t,"in",e),this.keys=lc(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class uc extends ec{constructor(t,e){super(t,"not-in",e),this.keys=lc(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function lc(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>ea.fromName(t.referenceValue)))}class dc extends ec{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return ja(e)&&Oa(e.arrayValue,this.value)}}class fc extends ec{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Oa(this.value.arrayValue,e)}}class pc extends ec{constructor(t,e){super(t,"not-in",e)}matches(t){if(Oa(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Oa(this.value.arrayValue,e)}}class gc extends ec{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!ja(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Oa(this.value.arrayValue,t)))}}class mc{constructor(t,e=null,n=[],i=[],r=null,s=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=i,this.limit=r,this.startAt=s,this.endAt=o,this.he=null}}function yc(t,e=null,n=[],i=[],r=null,s=null,o=null){return new mc(t,e,n,i,r,s,o)}function vc(t){const e=Lo(t);if(null===e.he){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>sc(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),la(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>Va(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>Va(t))).join(",")),e.he=t}return e.he}function wc(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Za(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!oc(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Ja(t.startAt,e.startAt)&&Ja(t.endAt,e.endAt)}function Ec(t){return ea.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class bc{constructor(t,e=null,n=[],i=[],r=null,s="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=i,this.limit=r,this.limitType=s,this.startAt=o,this.endAt=a,this.Pe=null,this.Ie=null,this.startAt,this.endAt}}function Tc(t){return new bc(t)}function Ic(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function _c(t){const e=Lo(t);if(null===e.Pe){e.Pe=[];const t=function(t){for(const e of t.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}(e),n=function(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}(e);if(null!==t&&null===n)t.isKeyField()||e.Pe.push(new Ya(t)),e.Pe.push(new Ya(ta.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.Pe.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.Pe.push(new Ya(ta.keyField(),t))}}}return e.Pe}function Cc(t){const e=Lo(t);if(!e.Ie)if("F"===e.limitType)e.Ie=yc(e.path,e.collectionGroup,_c(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of _c(e)){const e="desc"===n.dir?"asc":"desc";t.push(new Ya(n.field,e))}const n=e.endAt?new Wa(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new Wa(e.startAt.position,e.startAt.inclusive):null;e.Ie=yc(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}return e.Ie}function Sc(t,e,n){return new bc(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Ac(t,e){return wc(Cc(t),Cc(e))&&t.limitType===e.limitType}function Dc(t){return`${vc(Cc(t))}|lt:${t.limitType}`}function kc(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>ac(t))).join(", ")}]`),la(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>Va(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>Va(t))).join(",")),`Target(${e})`}(Cc(t))}; limitType=${t.limitType})`}function Nc(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):ea.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of _c(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const i=Xa(t,e,n);return t.inclusive?i<=0:i<0}(t.startAt,_c(t),e)||t.endAt&&!function(t,e,n){const i=Xa(t,e,n);return t.inclusive?i>=0:i>0}(t.endAt,_c(t),e))}(t,e)}function Rc(t){return(e,n)=>{let i=!1;for(const r of _c(t)){const t=xc(r,e,n);if(0!==t)return t;i=i||r.field.isKeyField()}return 0}}function xc(t,e,n){const i=t.field.isKeyField()?ea.comparator(e.key,n.key):function(t,e,n){const i=e.data.field(t),r=n.data.field(t);return null!==i&&null!==r?Pa(i,r):Ro()}(t.field,e,n);switch(t.dir){case"asc":return i;case"desc":return-1*i;default:return Ro()}}class Lc{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,i]of n)if(this.equalsFn(e,t))return i}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),i=this.inner[n];if(void 0===i)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],t))return void(i[n]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],t))return 1===n.length?delete this.inner[e]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(t){pa(this.inner,((e,n)=>{for(const[e,i]of n)t(e,i)}))}isEmpty(){return function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(this.inner)}size(){return this.innerSize}}const Mc=new ga(ea.comparator);function Oc(){return Mc}const Pc=new ga(ea.comparator);function Fc(...t){let e=Pc;for(const n of t)e=e.insert(n.key,n);return e}function Vc(t){let e=Pc;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function Uc(){return jc()}function Bc(){return jc()}function jc(){return new Lc((t=>t.toString()),((t,e)=>t.isEqual(e)))}new ga(ea.comparator);const $c=new va(ea.comparator);function qc(...t){let e=$c;for(const n of t)e=e.add(n);return e}const zc=new va(Go);class Kc{constructor(){this._=void 0}}function Hc(t,e,n){return t instanceof Qc?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Aa(e)&&(e=Da(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Wc?Xc(t,e):t instanceof Jc?Yc(t,e):function(t,e){const n=function(t,e){return t instanceof Zc?function(t){return Ba(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}(t,e),i=th(n)+th(t.Te);return Ba(n)&&Ba(t.Te)?function(t){return{integerValue:""+t}}(i):function(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:da(e)?"-0":e}}(t.serializer,i)}(t,e)}function Gc(t,e,n){return t instanceof Wc?Xc(t,e):t instanceof Jc?Yc(t,e):n}class Qc extends Kc{}class Wc extends Kc{constructor(t){super(),this.elements=t}}function Xc(t,e){const n=eh(e);for(const e of t.elements)n.some((t=>Ma(t,e)))||n.push(e);return{arrayValue:{values:n}}}class Jc extends Kc{constructor(t){super(),this.elements=t}}function Yc(t,e){let n=eh(e);for(const e of t.elements)n=n.filter((t=>!Ma(t,e)));return{arrayValue:{values:n}}}class Zc extends Kc{constructor(t,e){super(),this.serializer=t,this.Te=e}}function th(t){return Ca(t.integerValue||t.doubleValue)}function eh(t){return ja(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class nh{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new nh}static exists(t){return new nh(void 0,t)}static updateTime(t){return new nh(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function ih(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class rh{}function sh(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new ph(t.key,nh.none()):new hh(t.key,t.data,nh.none());{const n=t.data,i=Ga.empty();let r=new va(ta.comparator);for(let t of e.fields)if(!r.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?i.delete(t):i.set(t,e),r=r.add(t)}return new uh(t.key,i,new Ea(r.toArray()),nh.none())}}function oh(t,e,n){t instanceof hh?function(t,e,n){const i=t.value.clone(),r=dh(t.fieldTransforms,e,n.transformResults);i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):t instanceof uh?function(t,e,n){if(!ih(t.precondition,e))return void e.convertToUnknownDocument(n.version);const i=dh(t.fieldTransforms,e,n.transformResults),r=e.data;r.setAll(lh(t)),r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function ah(t,e,n,i){return t instanceof hh?function(t,e,n,i){if(!ih(t.precondition,e))return n;const r=t.value.clone(),s=fh(t.fieldTransforms,i,e);return r.setAll(s),e.convertToFoundDocument(e.version,r).setHasLocalMutations(),null}(t,e,n,i):t instanceof uh?function(t,e,n,i){if(!ih(t.precondition,e))return n;const r=fh(t.fieldTransforms,i,e),s=e.data;return s.setAll(lh(t)),s.setAll(r),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,i):function(t,e,n){return ih(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function ch(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Qo(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Wc&&e instanceof Wc||t instanceof Jc&&e instanceof Jc?Qo(t.elements,e.elements,Ma):t instanceof Zc&&e instanceof Zc?Ma(t.Te,e.Te):t instanceof Qc&&e instanceof Qc}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class hh extends rh{constructor(t,e,n,i=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class uh extends rh{constructor(t,e,n,i,r=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=i,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function lh(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const i=t.data.field(n);e.set(n,i)}})),e}function dh(t,e,n){const i=new Map;xo(t.length===n.length);for(let r=0;r<n.length;r++){const s=t[r],o=s.transform,a=e.data.field(s.field);i.set(s.field,Gc(o,a,n[r]))}return i}function fh(t,e,n){const i=new Map;for(const r of t){const t=r.transform,s=n.data.field(r.field);i.set(r.field,Hc(t,s,e))}return i}class ph extends rh{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class gh{constructor(t,e,n,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const i=this.mutations[e];i.key.isEqual(t.key)&&oh(i,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=ah(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=ah(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=Bc();return this.mutations.forEach((i=>{const r=t.get(i.key),s=r.overlayedDocument;let o=this.applyToLocalView(s,r.mutatedFields);o=e.has(i.key)?null:o;const a=sh(s,o);null!==a&&n.set(i.key,a),s.isValidDocument()||s.convertToNoDocument(Xo.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),qc())}isEqual(t){return this.batchId===t.batchId&&Qo(this.mutations,t.mutations,((t,e)=>ch(t,e)))&&Qo(this.baseMutations,t.baseMutations,((t,e)=>ch(t,e)))}}class mh{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class yh{constructor(t,e){this.count=t,this.unchangedNames=e}}var vh,wh;function Eh(t){if(void 0===t)return Do("GRPC error has no .code"),Mo.UNKNOWN;switch(t){case vh.OK:return Mo.OK;case vh.CANCELLED:return Mo.CANCELLED;case vh.UNKNOWN:return Mo.UNKNOWN;case vh.DEADLINE_EXCEEDED:return Mo.DEADLINE_EXCEEDED;case vh.RESOURCE_EXHAUSTED:return Mo.RESOURCE_EXHAUSTED;case vh.INTERNAL:return Mo.INTERNAL;case vh.UNAVAILABLE:return Mo.UNAVAILABLE;case vh.UNAUTHENTICATED:return Mo.UNAUTHENTICATED;case vh.INVALID_ARGUMENT:return Mo.INVALID_ARGUMENT;case vh.NOT_FOUND:return Mo.NOT_FOUND;case vh.ALREADY_EXISTS:return Mo.ALREADY_EXISTS;case vh.PERMISSION_DENIED:return Mo.PERMISSION_DENIED;case vh.FAILED_PRECONDITION:return Mo.FAILED_PRECONDITION;case vh.ABORTED:return Mo.ABORTED;case vh.OUT_OF_RANGE:return Mo.OUT_OF_RANGE;case vh.UNIMPLEMENTED:return Mo.UNIMPLEMENTED;case vh.DATA_LOSS:return Mo.DATA_LOSS;default:return Ro()}}(wh=vh||(vh={}))[wh.OK=0]="OK",wh[wh.CANCELLED=1]="CANCELLED",wh[wh.UNKNOWN=2]="UNKNOWN",wh[wh.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",wh[wh.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",wh[wh.NOT_FOUND=5]="NOT_FOUND",wh[wh.ALREADY_EXISTS=6]="ALREADY_EXISTS",wh[wh.PERMISSION_DENIED=7]="PERMISSION_DENIED",wh[wh.UNAUTHENTICATED=16]="UNAUTHENTICATED",wh[wh.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",wh[wh.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",wh[wh.ABORTED=10]="ABORTED",wh[wh.OUT_OF_RANGE=11]="OUT_OF_RANGE",wh[wh.UNIMPLEMENTED=12]="UNIMPLEMENTED",wh[wh.INTERNAL=13]="INTERNAL",wh[wh.UNAVAILABLE=14]="UNAVAILABLE",wh[wh.DATA_LOSS=15]="DATA_LOSS";class bh{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return Th}static getOrCreateInstance(){return null===Th&&(Th=new bh),Th}onExistenceFilterMismatch(t){const e=Symbol();return this.onExistenceFilterMismatchCallbacks.set(e,t),()=>this.onExistenceFilterMismatchCallbacks.delete(e)}notifyOnExistenceFilterMismatch(t){this.onExistenceFilterMismatchCallbacks.forEach((e=>e(t)))}}let Th=null;const Ih=new bo([4294967295,4294967295],0);function _h(t){const e=(new TextEncoder).encode(t),n=new Eo;return n.update(e),new Uint8Array(n.digest())}function Ch(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),i=e.getUint32(4,!0),r=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new bo([n,i],0),new bo([r,s],0)]}class Sh{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new Ah(`Invalid padding: ${e}`);if(n<0)throw new Ah(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new Ah(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new Ah(`Invalid padding when bitmap length is 0: ${e}`);this.de=8*t.length-e,this.Ae=bo.fromNumber(this.de)}Re(t,e,n){let i=t.add(e.multiply(bo.fromNumber(n)));return 1===i.compare(Ih)&&(i=new bo([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ae).toNumber()}Ve(t){return 0!=(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.de)return!1;const e=_h(t),[n,i]=Ch(e);for(let t=0;t<this.hashCount;t++){const e=this.Re(n,i,t);if(!this.Ve(e))return!1}return!0}static create(t,e,n){const i=t%8==0?0:8-t%8,r=new Uint8Array(Math.ceil(t/8)),s=new Sh(r,i,e);return n.forEach((t=>s.insert(t))),s}insert(t){if(0===this.de)return;const e=_h(t),[n,i]=Ch(e);for(let t=0;t<this.hashCount;t++){const e=this.Re(n,i,t);this.me(e)}}me(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class Ah extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Dh{constructor(t,e,n,i,r){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const i=new Map;return i.set(t,kh.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new Dh(Xo.min(),i,new ga(Go),Oc(),qc())}}class kh{constructor(t,e,n,i,r){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new kh(n,e,qc(),qc(),qc())}}class Nh{constructor(t,e,n,i){this.fe=t,this.removedTargetIds=e,this.key=n,this.ge=i}}class Rh{constructor(t,e){this.targetId=t,this.pe=e}}class xh{constructor(t,e,n=Ta.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=i}}class Lh{constructor(){this.ye=0,this.we=Ph(),this.Se=Ta.EMPTY_BYTE_STRING,this.be=!1,this.De=!0}get current(){return this.be}get resumeToken(){return this.Se}get ve(){return 0!==this.ye}get Ce(){return this.De}Fe(t){t.approximateByteSize()>0&&(this.De=!0,this.Se=t)}Me(){let t=qc(),e=qc(),n=qc();return this.we.forEach(((i,r)=>{switch(r){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:n=n.add(i);break;default:Ro()}})),new kh(this.Se,this.be,t,e,n)}xe(){this.De=!1,this.we=Ph()}Oe(t,e){this.De=!0,this.we=this.we.insert(t,e)}Ne(t){this.De=!0,this.we=this.we.remove(t)}Be(){this.ye+=1}Le(){this.ye-=1}ke(){this.De=!0,this.be=!0}}class Mh{constructor(t){this.qe=t,this.Qe=new Map,this.Ke=Oc(),this.$e=Oh(),this.Ue=new ga(Go)}We(t){for(const e of t.fe)t.ge&&t.ge.isFoundDocument()?this.Ge(e,t.ge):this.ze(e,t.key,t.ge);for(const e of t.removedTargetIds)this.ze(e,t.key,t.ge)}je(t){this.forEachTarget(t,(e=>{const n=this.He(e);switch(t.state){case 0:this.Je(e)&&n.Fe(t.resumeToken);break;case 1:n.Le(),n.ve||n.xe(),n.Fe(t.resumeToken);break;case 2:n.Le(),n.ve||this.removeTarget(e);break;case 3:this.Je(e)&&(n.ke(),n.Fe(t.resumeToken));break;case 4:this.Je(e)&&(this.Ye(e),n.Fe(t.resumeToken));break;default:Ro()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Qe.forEach(((t,n)=>{this.Je(n)&&e(n)}))}Ze(t){var e,n;const i=t.targetId,r=t.pe.count,s=this.Xe(i);if(s){const o=s.target;if(Ec(o))if(0===r){const t=new ea(o.path);this.ze(i,t,Qa.newNoDocument(t,Xo.min()))}else xo(1===r);else{const s=this.et(i);if(s!==r){const r=this.tt(t,s);if(0!==r.status){this.Ye(i);const t=2===r.status?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ue=this.Ue.insert(i,t)}null===(e=bh.instance)||void 0===e||e.notifyOnExistenceFilterMismatch(function(t,e,n,i){var r,s,o,a,c,h;const u={localCacheCount:n,existenceFilterCount:i.count},l=i.unchangedNames;return l&&(u.bloomFilter={applied:0===t,hashCount:null!==(r=null==l?void 0:l.hashCount)&&void 0!==r?r:0,bitmapLength:null!==(a=null===(o=null===(s=null==l?void 0:l.bits)||void 0===s?void 0:s.bitmap)||void 0===o?void 0:o.length)&&void 0!==a?a:0,padding:null!==(h=null===(c=null==l?void 0:l.bits)||void 0===c?void 0:c.padding)&&void 0!==h?h:0},e&&(u.bloomFilter.mightContain=e)),u}(r.status,null!==(n=r.nt)&&void 0!==n?n:null,s,t.pe))}}}}tt(t,e){const{unchangedNames:n,count:i}=t.pe;if(!n||!n.bits)return{status:1};const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=n;let a,c;try{a=Sa(r).toUint8Array()}catch(t){if(t instanceof ba)return ko("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),{status:1};throw t}try{c=new Sh(a,s,o)}catch(t){return ko(t instanceof Ah?"BloomFilter error: ":"Applying bloom filter failed: ",t),{status:1}}const h=t=>{const e=this.qe.rt();return c.mightContain(`projects/${e.projectId}/databases/${e.database}/documents/${t}`)};return 0===c.de?{status:1}:{status:i===e-this.it(t.targetId,h)?0:2,nt:h}}it(t,e){const n=this.qe.getRemoteKeysForTarget(t);let i=0;return n.forEach((n=>{e(n.path.canonicalString())||(this.ze(t,n,null),i++)})),i}st(t){const e=new Map;this.Qe.forEach(((n,i)=>{const r=this.Xe(i);if(r){if(n.current&&Ec(r.target)){const e=new ea(r.target.path);null!==this.Ke.get(e)||this.ot(i,e)||this.ze(i,e,Qa.newNoDocument(e,t))}n.Ce&&(e.set(i,n.Me()),n.xe())}}));let n=qc();this.$e.forEach(((t,e)=>{let i=!0;e.forEachWhile((t=>{const e=this.Xe(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(i=!1,!1)})),i&&(n=n.add(t))})),this.Ke.forEach(((e,n)=>n.setReadTime(t)));const i=new Dh(t,e,this.Ue,this.Ke,n);return this.Ke=Oc(),this.$e=Oh(),this.Ue=new ga(Go),i}Ge(t,e){if(!this.Je(t))return;const n=this.ot(t,e.key)?2:0;this.He(t).Oe(e.key,n),this.Ke=this.Ke.insert(e.key,e),this.$e=this.$e.insert(e.key,this._t(e.key).add(t))}ze(t,e,n){if(!this.Je(t))return;const i=this.He(t);this.ot(t,e)?i.Oe(e,1):i.Ne(e),this.$e=this.$e.insert(e,this._t(e).delete(t)),n&&(this.Ke=this.Ke.insert(e,n))}removeTarget(t){this.Qe.delete(t)}et(t){const e=this.He(t).Me();return this.qe.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Be(t){this.He(t).Be()}He(t){let e=this.Qe.get(t);return e||(e=new Lh,this.Qe.set(t,e)),e}_t(t){let e=this.$e.get(t);return e||(e=new va(Go),this.$e=this.$e.insert(t,e)),e}Je(t){const e=null!==this.Xe(t);return e||Ao("WatchChangeAggregator","Detected inactive target",t),e}Xe(t){const e=this.Qe.get(t);return e&&e.ve?null:this.qe.ut(t)}Ye(t){this.Qe.set(t,new Lh),this.qe.getRemoteKeysForTarget(t).forEach((e=>{this.ze(t,e,null)}))}ot(t,e){return this.qe.getRemoteKeysForTarget(t).has(e)}}function Oh(){return new ga(ea.comparator)}function Ph(){return new ga(ea.comparator)}const Fh={asc:"ASCENDING",desc:"DESCENDING"},Vh={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Uh={and:"AND",or:"OR"};class Bh{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function jh(t,e){return t.useProto3Json||la(e)?e:{value:e}}function $h(t){return xo(!!t),Xo.fromTimestamp(function(t){const e=_a(t);return new Wo(e.seconds,e.nanos)}(t))}function qh(t){const e=Yo.fromString(t);return xo(ru(e)),e}function zh(t,e){const n=qh(e);if(n.get(1)!==t.databaseId.projectId)throw new Oo(Mo.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Oo(Mo.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ea(Gh(n))}function Kh(t,e){return function(t,e){return function(t){return new Yo(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}(t.databaseId,e)}function Hh(t){return new Yo(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Gh(t){return xo(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Qh(t,e){return{documents:[Kh(t,e.path)]}}function Wh(t,e){const n={structuredQuery:{}},i=e.path;null!==e.collectionGroup?(n.parent=Kh(t,i),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Kh(t,i.popLast()),n.structuredQuery.from=[{collectionId:i.lastSegment()}]);const r=function(t){if(0!==t.length)return iu(nc.create(t,"and"))}(e.filters);r&&(n.structuredQuery.where=r);const s=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:eu(t.field),direction:Yh(t.dir)}}(t)))}(e.orderBy);s&&(n.structuredQuery.orderBy=s);const o=jh(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),n}function Xh(t){let e=function(t){const e=qh(t);return 4===e.length?Yo.emptyPath():Gh(e)}(t.parent);const n=t.structuredQuery,i=n.from?n.from.length:0;let r=null;if(i>0){xo(1===i);const t=n.from[0];t.allDescendants?r=t.collectionId:e=e.child(t.collectionId)}let s=[];n.where&&(s=function(t){const e=Jh(t);return e instanceof nc&&rc(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map((t=>function(t){return new Ya(nu(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,la(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new Wa(n,e)}(n.startAt));let h=null;return n.endAt&&(h=function(t){const e=!t.before,n=t.values||[];return new Wa(n,e)}(n.endAt)),function(t,e,n,i,r,s,o,a){return new bc(t,e,n,i,r,s,o,a)}(e,r,o,s,a,"F",c,h)}function Jh(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=nu(t.unaryFilter.field);return ec.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=nu(t.unaryFilter.field);return ec.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=nu(t.unaryFilter.field);return ec.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=nu(t.unaryFilter.field);return ec.create(r,"!=",{nullValue:"NULL_VALUE"});default:return Ro()}}(t):void 0!==t.fieldFilter?function(t){return ec.create(nu(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ro()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return nc.create(t.compositeFilter.filters.map((t=>Jh(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return Ro()}}(t.compositeFilter.op))}(t):Ro()}function Yh(t){return Fh[t]}function Zh(t){return Vh[t]}function tu(t){return Uh[t]}function eu(t){return{fieldPath:t.canonicalString()}}function nu(t){return ta.fromServerFormat(t.fieldPath)}function iu(t){return t instanceof ec?function(t){if("=="===t.op){if(qa(t.value))return{unaryFilter:{field:eu(t.field),op:"IS_NAN"}};if($a(t.value))return{unaryFilter:{field:eu(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(qa(t.value))return{unaryFilter:{field:eu(t.field),op:"IS_NOT_NAN"}};if($a(t.value))return{unaryFilter:{field:eu(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:eu(t.field),op:Zh(t.op),value:t.value}}}(t):t instanceof nc?function(t){const e=t.getFilters().map((t=>iu(t)));return 1===e.length?e[0]:{compositeFilter:{op:tu(t.op),filters:e}}}(t):Ro()}function ru(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class su{constructor(t,e,n,i,r=Xo.min(),s=Xo.min(),o=Ta.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new su(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new su(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new su(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new su(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class ou{constructor(t){this.ct=t}}function au(t){const e=Xh({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Sc(e,e.limit,"L"):e}class cu{constructor(){}Pt(t,e){this.It(t,e),e.Tt()}It(t,e){if("nullValue"in t)this.Et(e,5);else if("booleanValue"in t)this.Et(e,10),e.dt(t.booleanValue?1:0);else if("integerValue"in t)this.Et(e,15),e.dt(Ca(t.integerValue));else if("doubleValue"in t){const n=Ca(t.doubleValue);isNaN(n)?this.Et(e,13):(this.Et(e,15),da(n)?e.dt(0):e.dt(n))}else if("timestampValue"in t){const n=t.timestampValue;this.Et(e,20),"string"==typeof n?e.At(n):(e.At(`${n.seconds||""}`),e.dt(n.nanos||0))}else if("stringValue"in t)this.Rt(t.stringValue,e),this.Vt(e);else if("bytesValue"in t)this.Et(e,30),e.ft(Sa(t.bytesValue)),this.Vt(e);else if("referenceValue"in t)this.gt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Et(e,45),e.dt(n.latitude||0),e.dt(n.longitude||0)}else"mapValue"in t?Ha(t)?this.Et(e,Number.MAX_SAFE_INTEGER):(this.yt(t.mapValue,e),this.Vt(e)):"arrayValue"in t?(this.wt(t.arrayValue,e),this.Vt(e)):Ro()}Rt(t,e){this.Et(e,25),this.St(t,e)}St(t,e){e.At(t)}yt(t,e){const n=t.fields||{};this.Et(e,55);for(const t of Object.keys(n))this.Rt(t,e),this.It(n[t],e)}wt(t,e){const n=t.values||[];this.Et(e,50);for(const t of n)this.It(t,e)}gt(t,e){this.Et(e,37),ea.fromName(t).path.forEach((t=>{this.Et(e,60),this.St(t,e)}))}Et(t,e){t.dt(e)}Vt(t){t.dt(2)}}cu.bt=new cu;class hu{constructor(){this.sn=new uu}addToCollectionParentIndex(t,e){return this.sn.add(e),ca.resolve()}getCollectionParents(t,e){return ca.resolve(this.sn.getEntries(e))}addFieldIndex(t,e){return ca.resolve()}deleteFieldIndex(t,e){return ca.resolve()}getDocumentsMatchingTarget(t,e){return ca.resolve(null)}getIndexType(t,e){return ca.resolve(0)}getFieldIndexes(t,e){return ca.resolve([])}getNextCollectionGroupToUpdate(t){return ca.resolve(null)}getMinOffset(t,e){return ca.resolve(ia.min())}getMinOffsetFromCollectionGroup(t,e){return ca.resolve(ia.min())}updateCollectionGroup(t,e,n){return ca.resolve()}updateIndexEntries(t,e){return ca.resolve()}}class uu{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e]||new va(Yo.comparator),r=!i.has(n);return this.index[e]=i.add(n),r}has(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e];return i&&i.has(n)}getEntries(t){return(this.index[t]||new va(Yo.comparator)).toArray()}}new Uint8Array(0);class lu{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new lu(t,lu.DEFAULT_COLLECTION_PERCENTILE,lu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}lu.DEFAULT_COLLECTION_PERCENTILE=10,lu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,lu.DEFAULT=new lu(41943040,lu.DEFAULT_COLLECTION_PERCENTILE,lu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),lu.DISABLED=new lu(-1,0,0);class du{constructor(t){this.Mn=t}next(){return this.Mn+=2,this.Mn}static xn(){return new du(0)}static On(){return new du(-1)}}class fu{constructor(){this.changes=new Lc((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Qa.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?ca.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class pu{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class gu{constructor(t,e,n,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=i}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((i=>(n=i,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&ah(n.mutation,t,Ea.empty(),Wo.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,qc()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=qc()){const i=Uc();return this.populateOverlays(t,i,e).next((()=>this.computeViews(t,e,i,n).next((t=>{let e=Fc();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=Uc();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,qc())))}populateOverlays(t,e,n){const i=[];return n.forEach((t=>{e.has(t)||i.push(t)})),this.documentOverlayCache.getOverlays(t,i).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,i){let r=Oc();const s=jc(),o=jc();return e.forEach(((t,e)=>{const o=n.get(e.key);i.has(e.key)&&(void 0===o||o.mutation instanceof uh)?r=r.insert(e.key,e):void 0!==o?(s.set(e.key,o.mutation.getFieldMask()),ah(o.mutation,e,o.mutation.getFieldMask(),Wo.now())):s.set(e.key,Ea.empty())})),this.recalculateAndSaveOverlays(t,r).next((t=>(t.forEach(((t,e)=>s.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new pu(e,null!==(n=s.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=jc();let i=new ga(((t,e)=>t-e)),r=qc();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const r of t)r.keys().forEach((t=>{const s=e.get(t);if(null===s)return;let o=n.get(t)||Ea.empty();o=r.applyToLocalView(s,o),n.set(t,o);const a=(i.get(r.batchId)||qc()).add(t);i=i.insert(r.batchId,a)}))})).next((()=>{const s=[],o=i.getReverseIterator();for(;o.hasNext();){const i=o.getNext(),a=i.key,c=i.value,h=Bc();c.forEach((t=>{if(!r.has(t)){const i=sh(e.get(t),n.get(t));null!==i&&h.set(t,i),r=r.add(t)}})),s.push(this.documentOverlayCache.saveOverlays(t,a,h))}return ca.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n){return function(t){return ea.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):function(t){return null!==t.collectionGroup}(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)}getNextDocuments(t,e,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,i).next((r=>{const s=i-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,i-r.size):ca.resolve(Uc());let o=-1,a=r;return s.next((e=>ca.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),r.get(e)?ca.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,r))).next((()=>this.computeViews(t,a,e,qc()))).next((t=>({batchId:o,changes:Vc(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new ea(e)).next((t=>{let e=Fc();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n){const i=e.collectionGroup;let r=Fc();return this.indexManager.getCollectionParents(t,i).next((s=>ca.forEach(s,(s=>{const o=function(t,e){return new bc(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return this.getDocumentsMatchingCollectionQuery(t,o,n).next((t=>{t.forEach(((t,e)=>{r=r.insert(t,e)}))}))})).next((()=>r))))}getDocumentsMatchingCollectionQuery(t,e,n){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((r=>(i=r,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i)))).next((t=>{i.forEach(((e,n)=>{const i=n.getKey();null===t.get(i)&&(t=t.insert(i,Qa.newInvalidDocument(i)))}));let n=Fc();return t.forEach(((t,r)=>{const s=i.get(t);void 0!==s&&ah(s.mutation,r,Ea.empty(),Wo.now()),Nc(e,r)&&(n=n.insert(t,r))})),n}))}}class mu{constructor(t){this.serializer=t,this.ar=new Map,this.ur=new Map}getBundleMetadata(t,e){return ca.resolve(this.ar.get(e))}saveBundleMetadata(t,e){return this.ar.set(e.id,function(t){return{id:t.id,version:t.version,createTime:$h(t.createTime)}}(e)),ca.resolve()}getNamedQuery(t,e){return ca.resolve(this.ur.get(e))}saveNamedQuery(t,e){return this.ur.set(e.name,function(t){return{name:t.name,query:au(t.bundledQuery),readTime:$h(t.readTime)}}(e)),ca.resolve()}}class yu{constructor(){this.overlays=new ga(ea.comparator),this.cr=new Map}getOverlay(t,e){return ca.resolve(this.overlays.get(e))}getOverlays(t,e){const n=Uc();return ca.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,i)=>{this.ht(t,e,i)})),ca.resolve()}removeOverlaysForBatchId(t,e,n){const i=this.cr.get(n);return void 0!==i&&(i.forEach((t=>this.overlays=this.overlays.remove(t))),this.cr.delete(n)),ca.resolve()}getOverlaysForCollection(t,e,n){const i=Uc(),r=e.length+1,s=new ea(e.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const t=o.getNext().value,s=t.getKey();if(!e.isPrefixOf(s.path))break;s.path.length===r&&t.largestBatchId>n&&i.set(t.getKey(),t)}return ca.resolve(i)}getOverlaysForCollectionGroup(t,e,n,i){let r=new ga(((t,e)=>t-e));const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=r.get(t.largestBatchId);null===e&&(e=Uc(),r=r.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=Uc(),a=r.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=i)););return ca.resolve(o)}ht(t,e,n){const i=this.overlays.get(n.key);if(null!==i){const t=this.cr.get(i.largestBatchId).delete(n.key);this.cr.set(i.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new mh(e,n));let r=this.cr.get(e);void 0===r&&(r=qc(),this.cr.set(e,r)),this.cr.set(e,r.add(n.key))}}class vu{constructor(){this.lr=new va(wu.hr),this.Pr=new va(wu.Ir)}isEmpty(){return this.lr.isEmpty()}addReference(t,e){const n=new wu(t,e);this.lr=this.lr.add(n),this.Pr=this.Pr.add(n)}Tr(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.Er(new wu(t,e))}dr(t,e){t.forEach((t=>this.removeReference(t,e)))}Ar(t){const e=new ea(new Yo([])),n=new wu(e,t),i=new wu(e,t+1),r=[];return this.Pr.forEachInRange([n,i],(t=>{this.Er(t),r.push(t.key)})),r}Rr(){this.lr.forEach((t=>this.Er(t)))}Er(t){this.lr=this.lr.delete(t),this.Pr=this.Pr.delete(t)}Vr(t){const e=new ea(new Yo([])),n=new wu(e,t),i=new wu(e,t+1);let r=qc();return this.Pr.forEachInRange([n,i],(t=>{r=r.add(t.key)})),r}containsKey(t){const e=new wu(t,0),n=this.lr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class wu{constructor(t,e){this.key=t,this.mr=e}static hr(t,e){return ea.comparator(t.key,e.key)||Go(t.mr,e.mr)}static Ir(t,e){return Go(t.mr,e.mr)||ea.comparator(t.key,e.key)}}class Eu{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.gr=1,this.pr=new va(wu.hr)}checkEmpty(t){return ca.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,i){const r=this.gr;this.gr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new gh(r,e,n,i);this.mutationQueue.push(s);for(const e of i)this.pr=this.pr.add(new wu(e.key,r)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return ca.resolve(s)}lookupMutationBatch(t,e){return ca.resolve(this.yr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,i=this.wr(n),r=i<0?0:i;return ca.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return ca.resolve(0===this.mutationQueue.length?-1:this.gr-1)}getAllMutationBatches(t){return ca.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new wu(e,0),i=new wu(e,Number.POSITIVE_INFINITY),r=[];return this.pr.forEachInRange([n,i],(t=>{const e=this.yr(t.mr);r.push(e)})),ca.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new va(Go);return e.forEach((t=>{const e=new wu(t,0),i=new wu(t,Number.POSITIVE_INFINITY);this.pr.forEachInRange([e,i],(t=>{n=n.add(t.mr)}))})),ca.resolve(this.Sr(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,i=n.length+1;let r=n;ea.isDocumentKey(r)||(r=r.child(""));const s=new wu(new ea(r),0);let o=new va(Go);return this.pr.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===i&&(o=o.add(t.mr)),!0)}),s),ca.resolve(this.Sr(o))}Sr(t){const e=[];return t.forEach((t=>{const n=this.yr(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){xo(0===this.br(e.batchId,"removed")),this.mutationQueue.shift();let n=this.pr;return ca.forEach(e.mutations,(i=>{const r=new wu(i.key,e.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((()=>{this.pr=n}))}Cn(t){}containsKey(t,e){const n=new wu(e,0),i=this.pr.firstAfterOrEqual(n);return ca.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,ca.resolve()}br(t,e){return this.wr(t)}wr(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}yr(t){const e=this.wr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class bu{constructor(t){this.Dr=t,this.docs=new ga(ea.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,i=this.docs.get(n),r=i?i.size:0,s=this.Dr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:s}),this.size+=s-r,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return ca.resolve(n?n.document.mutableCopy():Qa.newInvalidDocument(e))}getEntries(t,e){let n=Oc();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():Qa.newInvalidDocument(t))})),ca.resolve(n)}getDocumentsMatchingQuery(t,e,n,i){let r=Oc();const s=e.path,o=new ea(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!s.isPrefixOf(t.path))break;t.path.length>s.length+1||ra(na(o),n)<=0||(i.has(o.key)||Nc(e,o))&&(r=r.insert(o.key,o.mutableCopy()))}return ca.resolve(r)}getAllFromCollectionGroup(t,e,n,i){Ro()}vr(t,e){return ca.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new Tu(this)}getSize(t){return ca.resolve(this.size)}}class Tu extends fu{constructor(t){super(),this.sr=t}applyChanges(t){const e=[];return this.changes.forEach(((n,i)=>{i.isValidDocument()?e.push(this.sr.addEntry(t,i)):this.sr.removeEntry(n)})),ca.waitFor(e)}getFromCache(t,e){return this.sr.getEntry(t,e)}getAllFromCache(t,e){return this.sr.getEntries(t,e)}}class Iu{constructor(t){this.persistence=t,this.Cr=new Lc((t=>vc(t)),wc),this.lastRemoteSnapshotVersion=Xo.min(),this.highestTargetId=0,this.Fr=0,this.Mr=new vu,this.targetCount=0,this.Or=du.xn()}forEachTarget(t,e){return this.Cr.forEach(((t,n)=>e(n))),ca.resolve()}getLastRemoteSnapshotVersion(t){return ca.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return ca.resolve(this.Fr)}allocateTargetId(t){return this.highestTargetId=this.Or.next(),ca.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Fr&&(this.Fr=e),ca.resolve()}Ln(t){this.Cr.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Or=new du(e),this.highestTargetId=e),t.sequenceNumber>this.Fr&&(this.Fr=t.sequenceNumber)}addTargetData(t,e){return this.Ln(e),this.targetCount+=1,ca.resolve()}updateTargetData(t,e){return this.Ln(e),ca.resolve()}removeTargetData(t,e){return this.Cr.delete(e.target),this.Mr.Ar(e.targetId),this.targetCount-=1,ca.resolve()}removeTargets(t,e,n){let i=0;const r=[];return this.Cr.forEach(((s,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Cr.delete(s),r.push(this.removeMatchingKeysForTargetId(t,o.targetId)),i++)})),ca.waitFor(r).next((()=>i))}getTargetCount(t){return ca.resolve(this.targetCount)}getTargetData(t,e){const n=this.Cr.get(e)||null;return ca.resolve(n)}addMatchingKeys(t,e,n){return this.Mr.Tr(e,n),ca.resolve()}removeMatchingKeys(t,e,n){this.Mr.dr(e,n);const i=this.persistence.referenceDelegate,r=[];return i&&e.forEach((e=>{r.push(i.markPotentiallyOrphaned(t,e))})),ca.waitFor(r)}removeMatchingKeysForTargetId(t,e){return this.Mr.Ar(e),ca.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Mr.Vr(e);return ca.resolve(n)}containsKey(t,e){return ca.resolve(this.Mr.containsKey(e))}}class _u{constructor(t,e){this.Nr={},this.overlays={},this.Br=new ua(0),this.Lr=!1,this.Lr=!0,this.referenceDelegate=t(this),this.kr=new Iu(this),this.indexManager=new hu,this.remoteDocumentCache=function(t){return new bu(t)}((t=>this.referenceDelegate.qr(t))),this.serializer=new ou(e),this.Qr=new mu(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Lr=!1,Promise.resolve()}get started(){return this.Lr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new yu,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Nr[t.toKey()];return n||(n=new Eu(e,this.referenceDelegate),this.Nr[t.toKey()]=n),n}getTargetCache(){return this.kr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Qr}runTransaction(t,e,n){Ao("MemoryPersistence","Starting transaction:",t);const i=new Cu(this.Br.next());return this.referenceDelegate.Kr(),n(i).next((t=>this.referenceDelegate.$r(i).next((()=>t)))).toPromise().then((t=>(i.raiseOnCommittedEvent(),t)))}Ur(t,e){return ca.or(Object.values(this.Nr).map((n=>()=>n.containsKey(t,e))))}}class Cu extends oa{constructor(t){super(),this.currentSequenceNumber=t}}class Su{constructor(t){this.persistence=t,this.Wr=new vu,this.Gr=null}static zr(t){return new Su(t)}get jr(){if(this.Gr)return this.Gr;throw Ro()}addReference(t,e,n){return this.Wr.addReference(n,e),this.jr.delete(n.toString()),ca.resolve()}removeReference(t,e,n){return this.Wr.removeReference(n,e),this.jr.add(n.toString()),ca.resolve()}markPotentiallyOrphaned(t,e){return this.jr.add(e.toString()),ca.resolve()}removeTarget(t,e){this.Wr.Ar(e.targetId).forEach((t=>this.jr.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.jr.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Kr(){this.Gr=new Set}$r(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ca.forEach(this.jr,(n=>{const i=ea.fromPath(n);return this.Hr(t,i).next((t=>{t||e.removeEntry(i,Xo.min())}))})).next((()=>(this.Gr=null,e.apply(t))))}updateLimboDocument(t,e){return this.Hr(t,e).next((t=>{t?this.jr.delete(e.toString()):this.jr.add(e.toString())}))}qr(t){return 0}Hr(t,e){return ca.or([()=>ca.resolve(this.Wr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ur(t,e)])}}class Au{constructor(t,e,n,i){this.targetId=t,this.fromCache=e,this.Li=n,this.ki=i}static qi(t,e){let n=qc(),i=qc();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:i=i.add(t.doc.key)}return new Au(t,e.fromCache,n,i)}}class Du{constructor(){this.Qi=!1}initialize(t,e){this.Ki=t,this.indexManager=e,this.Qi=!0}getDocumentsMatchingQuery(t,e,n,i){return this.$i(t,e).next((r=>r||this.Ui(t,e,i,n))).next((n=>n||this.Wi(t,e)))}$i(t,e){if(Ic(e))return ca.resolve(null);let n=Cc(e);return this.indexManager.getIndexType(t,n).next((i=>0===i?null:(null!==e.limit&&1===i&&(e=Sc(e,null,"F"),n=Cc(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((i=>{const r=qc(...i);return this.Ki.getDocuments(t,r).next((i=>this.indexManager.getMinOffset(t,n).next((n=>{const s=this.Gi(e,i);return this.zi(e,s,r,n.readTime)?this.$i(t,Sc(e,null,"F")):this.ji(t,s,e,n)}))))})))))}Ui(t,e,n,i){return Ic(e)||i.isEqual(Xo.min())?this.Wi(t,e):this.Ki.getDocuments(t,n).next((r=>{const s=this.Gi(e,r);return this.zi(e,s,n,i)?this.Wi(t,e):(So()<=S.DEBUG&&Ao("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),kc(e)),this.ji(t,s,e,function(t,e){const n=t.toTimestamp().seconds,i=t.toTimestamp().nanoseconds+1,r=Xo.fromTimestamp(1e9===i?new Wo(n+1,0):new Wo(n,i));return new ia(r,ea.empty(),e)}(i,-1)))}))}Gi(t,e){let n=new va(Rc(t));return e.forEach(((e,i)=>{Nc(t,i)&&(n=n.add(i))})),n}zi(t,e,n,i){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const r="F"===t.limitType?e.last():e.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}Wi(t,e){return So()<=S.DEBUG&&Ao("QueryEngine","Using full collection scan to execute query:",kc(e)),this.Ki.getDocumentsMatchingQuery(t,e,ia.min())}ji(t,e,n,i){return this.Ki.getDocumentsMatchingQuery(t,n,i).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class ku{constructor(t,e,n,i){this.persistence=t,this.Hi=e,this.serializer=i,this.Ji=new ga(Go),this.Yi=new Lc((t=>vc(t)),wc),this.Zi=new Map,this.Xi=t.getRemoteDocumentCache(),this.kr=t.getTargetCache(),this.Qr=t.getBundleCache(),this.es(n)}es(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new gu(this.Xi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Xi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ji)))}}async function Nu(t,e){const n=Lo(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let i;return n.mutationQueue.getAllMutationBatches(t).next((r=>(i=r,n.es(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const r=[],s=[];let o=qc();for(const t of i){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({ts:t,removedBatchIds:r,addedBatchIds:s})))}))}))}function Ru(t){const e=Lo(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.kr.getLastRemoteSnapshotVersion(t)))}async function xu(t,e,n){const i=Lo(t),r=i.Ji.get(e),s=n?"readwrite":"readwrite-primary";try{n||await i.persistence.runTransaction("Release target",s,(t=>i.persistence.referenceDelegate.removeTarget(t,r)))}catch(t){if(!ha(t))throw t;Ao("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}i.Ji=i.Ji.remove(e),i.Yi.delete(r.target)}function Lu(t,e,n){const i=Lo(t);let r=Xo.min(),s=qc();return i.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const i=Lo(t),r=i.Yi.get(n);return void 0!==r?ca.resolve(i.Ji.get(r)):i.kr.getTargetData(e,n)}(i,t,Cc(e)).next((e=>{if(e)return r=e.lastLimboFreeSnapshotVersion,i.kr.getMatchingKeysForTargetId(t,e.targetId).next((t=>{s=t}))})).next((()=>i.Hi.getDocumentsMatchingQuery(t,e,n?r:Xo.min(),n?s:qc()))).next((t=>(function(t,e,n){let i=t.Zi.get(e)||Xo.min();n.forEach(((t,e)=>{e.readTime.compareTo(i)>0&&(i=e.readTime)})),t.Zi.set(e,i)}(i,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,ss:s})))))}class Mu{constructor(){this.activeTargetIds=zc}hs(t){this.activeTargetIds=this.activeTargetIds.add(t)}Ps(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ls(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Ou{constructor(){this.Hs=new Mu,this.Js={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.Hs.hs(t),this.Js[t]||"not-current"}updateQueryState(t,e,n){this.Js[t]=e}removeLocalQueryTarget(t){this.Hs.Ps(t)}isLocalQueryTarget(t){return this.Hs.activeTargetIds.has(t)}clearQueryState(t){delete this.Js[t]}getAllActiveQueryTargets(){return this.Hs.activeTargetIds}isActiveQueryTarget(t){return this.Hs.activeTargetIds.has(t)}start(){return this.Hs=new Mu,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class Pu{Ys(t){}shutdown(){}}class Fu{constructor(){this.Zs=()=>this.Xs(),this.eo=()=>this.no(),this.ro=[],this.io()}Ys(t){this.ro.push(t)}shutdown(){window.removeEventListener("online",this.Zs),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Zs),window.addEventListener("offline",this.eo)}Xs(){Ao("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.ro)t(0)}no(){Ao("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.ro)t(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Vu=null;function Uu(){return null===Vu?Vu=268435456+Math.round(2147483648*Math.random()):Vu++,"0x"+Vu.toString(16)}const Bu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class ju{constructor(t){this.so=t.so,this.oo=t.oo}_o(t){this.ao=t}uo(t){this.co=t}onMessage(t){this.lo=t}close(){this.oo()}send(t){this.so(t)}ho(){this.ao()}Po(t){this.co(t)}Io(t){this.lo(t)}}const $u="WebChannelConnection";class qu extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.To=e+"://"+t.host,this.Eo=`projects/${n}/databases/${i}`,this.Ao="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${i}`}get Ro(){return!1}Vo(t,e,n,i,r){const s=Uu(),o=this.mo(t,e);Ao("RestConnection",`Sending RPC '${t}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.Eo,"x-goog-request-params":this.Ao};return this.fo(a,i,r),this.po(t,o,a,n).then((e=>(Ao("RestConnection",`Received RPC '${t}' ${s}: `,e),e)),(e=>{throw ko("RestConnection",`RPC '${t}' ${s} failed with error: `,e,"url: ",o,"request:",n),e}))}yo(t,e,n,i,r,s){return this.Vo(t,e,n,i,r)}fo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+_o,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}mo(t,e){const n=Bu[t];return`${this.To}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}po(t,e,n,i){const r=Uu();return new Promise(((s,o)=>{const a=new wo;a.setWithCredentials(!0),a.listenOnce(po.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case fo.NO_ERROR:const e=a.getResponseJson();Ao($u,`XHR for RPC '${t}' ${r} received:`,JSON.stringify(e)),s(e);break;case fo.TIMEOUT:Ao($u,`RPC '${t}' ${r} timed out`),o(new Oo(Mo.DEADLINE_EXCEEDED,"Request time out"));break;case fo.HTTP_ERROR:const n=a.getStatus();if(Ao($u,`RPC '${t}' ${r} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Mo).indexOf(e)>=0?e:Mo.UNKNOWN}(e.status);o(new Oo(t,e.message))}else o(new Oo(Mo.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Oo(Mo.UNAVAILABLE,"Connection failed."));break;default:Ro()}}finally{Ao($u,`RPC '${t}' ${r} completed.`)}}));const c=JSON.stringify(i);Ao($u,`RPC '${t}' ${r} sending request:`,i),a.send(e,"POST",c,n,15)}))}wo(t,e,n){const i=Uu(),r=[this.To,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=uo(),o=lo(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.xmlHttpFactory=new yo({})),this.fo(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const h=r.join("");Ao($u,`Creating RPC '${t}' stream ${i}: ${h}`,a);const u=s.createWebChannel(h,a);let l=!1,d=!1;const f=new ju({so:e=>{d?Ao($u,`Not sending because RPC '${t}' stream ${i} is closed:`,e):(l||(Ao($u,`Opening RPC '${t}' stream ${i} transport.`),u.open(),l=!0),Ao($u,`RPC '${t}' stream ${i} sending:`,e),u.send(e))},oo:()=>u.close()}),p=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return p(u,vo.EventType.OPEN,(()=>{d||Ao($u,`RPC '${t}' stream ${i} transport opened.`)})),p(u,vo.EventType.CLOSE,(()=>{d||(d=!0,Ao($u,`RPC '${t}' stream ${i} transport closed`),f.Po())})),p(u,vo.EventType.ERROR,(e=>{d||(d=!0,ko($u,`RPC '${t}' stream ${i} transport errored:`,e),f.Po(new Oo(Mo.UNAVAILABLE,"The operation could not be completed")))})),p(u,vo.EventType.MESSAGE,(e=>{var n;if(!d){const r=e.data[0];xo(!!r);const s=r,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){Ao($u,`RPC '${t}' stream ${i} received error:`,o);const e=o.status;let n=function(t){const e=vh[t];if(void 0!==e)return Eh(e)}(e),r=o.message;void 0===n&&(n=Mo.INTERNAL,r="Unknown error status: "+e+" with message "+o.message),d=!0,f.Po(new Oo(n,r)),u.close()}else Ao($u,`RPC '${t}' stream ${i} received:`,r),f.Io(r)}})),p(o,go.STAT_EVENT,(e=>{e.stat===mo.PROXY?Ao($u,`RPC '${t}' stream ${i} detected buffering proxy`):e.stat===mo.NOPROXY&&Ao($u,`RPC '${t}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{f.ho()}),0),f}}function zu(){return"undefined"!=typeof document?document:null}function Ku(t){return new Bh(t,!0)}class Hu{constructor(t,e,n=1e3,i=1.5,r=6e4){this.ii=t,this.timerId=e,this.So=n,this.bo=i,this.Do=r,this.vo=0,this.Co=null,this.Fo=Date.now(),this.reset()}reset(){this.vo=0}Mo(){this.vo=this.Do}xo(t){this.cancel();const e=Math.floor(this.vo+this.Oo()),n=Math.max(0,Date.now()-this.Fo),i=Math.max(0,e-n);i>0&&Ao("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.vo} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Co=this.ii.enqueueAfterDelay(this.timerId,i,(()=>(this.Fo=Date.now(),t()))),this.vo*=this.bo,this.vo<this.So&&(this.vo=this.So),this.vo>this.Do&&(this.vo=this.Do)}No(){null!==this.Co&&(this.Co.skipDelay(),this.Co=null)}cancel(){null!==this.Co&&(this.Co.cancel(),this.Co=null)}Oo(){return(Math.random()-.5)*this.vo}}class Gu{constructor(t,e,n,i,r,s,o,a){this.ii=t,this.Bo=n,this.Lo=i,this.connection=r,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.ko=0,this.qo=null,this.Qo=null,this.stream=null,this.Ko=new Hu(t,e)}$o(){return 1===this.state||5===this.state||this.Uo()}Uo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Wo()}async stop(){this.$o()&&await this.close(0)}Go(){this.state=0,this.Ko.reset()}zo(){this.Uo()&&null===this.qo&&(this.qo=this.ii.enqueueAfterDelay(this.Bo,6e4,(()=>this.jo())))}Ho(t){this.Jo(),this.stream.send(t)}async jo(){if(this.Uo())return this.close(0)}Jo(){this.qo&&(this.qo.cancel(),this.qo=null)}Yo(){this.Qo&&(this.Qo.cancel(),this.Qo=null)}async close(t,e){this.Jo(),this.Yo(),this.Ko.cancel(),this.ko++,4!==t?this.Ko.reset():e&&e.code===Mo.RESOURCE_EXHAUSTED?(Do(e.toString()),Do("Using maximum backoff delay to prevent overloading the backend."),this.Ko.Mo()):e&&e.code===Mo.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Zo(),this.stream.close(),this.stream=null),this.state=t,await this.listener.uo(e)}Zo(){}auth(){this.state=1;const t=this.Xo(this.ko),e=this.ko;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.ko===e&&this.e_(t,n)}),(e=>{t((()=>{const t=new Oo(Mo.UNKNOWN,"Fetching auth token failed: "+e.message);return this.t_(t)}))}))}e_(t,e){const n=this.Xo(this.ko);this.stream=this.n_(t,e),this.stream._o((()=>{n((()=>(this.state=2,this.Qo=this.ii.enqueueAfterDelay(this.Lo,1e4,(()=>(this.Uo()&&(this.state=3),Promise.resolve()))),this.listener._o())))})),this.stream.uo((t=>{n((()=>this.t_(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Wo(){this.state=5,this.Ko.xo((async()=>{this.state=0,this.start()}))}t_(t){return Ao("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Xo(t){return e=>{this.ii.enqueueAndForget((()=>this.ko===t?e():(Ao("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Qu extends Gu{constructor(t,e,n,i,r,s){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,i,s),this.serializer=r}n_(t,e){return this.connection.wo("Listen",t,e)}onMessage(t){this.Ko.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const i=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Ro()}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=function(t,e){return t.useProto3Json?(xo(void 0===e||"string"==typeof e),Ta.fromBase64String(e||"")):(xo(void 0===e||e instanceof Uint8Array),Ta.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Mo.UNKNOWN:Eh(t.code);return new Oo(e,t.message||"")}(o);n=new xh(i,r,s,a||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const r=zh(t,i.document.name),s=$h(i.document.updateTime),o=i.document.createTime?$h(i.document.createTime):Xo.min(),a=new Ga({mapValue:{fields:i.document.fields}}),c=Qa.newFoundDocument(r,s,o,a),h=i.targetIds||[],u=i.removedTargetIds||[];n=new Nh(h,u,c.key,c)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const r=zh(t,i.document),s=i.readTime?$h(i.readTime):Xo.min(),o=Qa.newNoDocument(r,s),a=i.removedTargetIds||[];n=new Nh([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const r=zh(t,i.document),s=i.removedTargetIds||[];n=new Nh([],s,r,null)}else{if(!("filter"in e))return Ro();{e.filter;const t=e.filter;t.targetId;const{count:i=0,unchangedNames:r}=t,s=new yh(i,r),o=t.targetId;n=new Rh(o,s)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Xo.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Xo.min():e.readTime?$h(e.readTime):Xo.min()}(t);return this.listener.r_(e,n)}i_(t){const e={};e.database=Hh(this.serializer),e.addTarget=function(t,e){let n;const i=e.target;if(n=Ec(i)?{documents:Qh(t,i)}:{query:Wh(t,i)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=function(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}(t,e.resumeToken);const i=jh(t,e.expectedCount);null!==i&&(n.expectedCount=i)}else if(e.snapshotVersion.compareTo(Xo.min())>0){n.readTime=function(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}(t,e.snapshotVersion.toTimestamp());const i=jh(t,e.expectedCount);null!==i&&(n.expectedCount=i)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ro()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.Ho(e)}s_(t){const e={};e.database=Hh(this.serializer),e.removeTarget=t,this.Ho(e)}}class Wu extends class{}{constructor(t,e,n,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=i,this.h_=!1}P_(){if(this.h_)throw new Oo(Mo.FAILED_PRECONDITION,"The client has already been terminated.")}Vo(t,e,n){return this.P_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,r])=>this.connection.Vo(t,e,n,i,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Mo.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Oo(Mo.UNKNOWN,t.toString())}))}yo(t,e,n,i){return this.P_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,s])=>this.connection.yo(t,e,n,r,s,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Mo.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Oo(Mo.UNKNOWN,t.toString())}))}terminate(){this.h_=!0}}class Xu{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.T_=0,this.E_=null,this.d_=!0}A_(){0===this.T_&&(this.R_("Unknown"),this.E_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.E_=null,this.V_("Backend didn't respond within 10 seconds."),this.R_("Offline"),Promise.resolve()))))}m_(t){"Online"===this.state?this.R_("Unknown"):(this.T_++,this.T_>=1&&(this.f_(),this.V_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.R_("Offline")))}set(t){this.f_(),this.T_=0,"Online"===t&&(this.d_=!1),this.R_(t)}R_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}V_(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.d_?(Do(e),this.d_=!1):Ao("OnlineStateTracker",e)}f_(){null!==this.E_&&(this.E_.cancel(),this.E_=null)}}class Ju{constructor(t,e,n,i,r){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.g_=[],this.p_=new Map,this.y_=new Set,this.w_=[],this.S_=r,this.S_.Ys((t=>{n.enqueueAndForget((async()=>{ol(this)&&(Ao("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Lo(t);e.y_.add(4),await Zu(e),e.b_.set("Unknown"),e.y_.delete(4),await Yu(e)}(this))}))})),this.b_=new Xu(n,i)}}async function Yu(t){if(ol(t))for(const e of t.w_)await e(!0)}async function Zu(t){for(const e of t.w_)await e(!1)}function tl(t,e){const n=Lo(t);n.p_.has(e.targetId)||(n.p_.set(e.targetId,e),sl(n)?rl(n):fl(n).Uo()&&nl(n,e))}function el(t,e){const n=Lo(t),i=fl(n);n.p_.delete(e),i.Uo()&&il(n,e),0===n.p_.size&&(i.Uo()?i.zo():ol(n)&&n.b_.set("Unknown"))}function nl(t,e){if(t.D_.Be(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Xo.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}fl(t).i_(e)}function il(t,e){t.D_.Be(e),fl(t).s_(e)}function rl(t){t.D_=new Mh({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ut:e=>t.p_.get(e)||null,rt:()=>t.datastore.serializer.databaseId}),fl(t).start(),t.b_.A_()}function sl(t){return ol(t)&&!fl(t).$o()&&t.p_.size>0}function ol(t){return 0===Lo(t).y_.size}function al(t){t.D_=void 0}async function cl(t){t.p_.forEach(((e,n)=>{nl(t,e)}))}async function hl(t,e){al(t),sl(t)?(t.b_.m_(e),rl(t)):t.b_.set("Unknown")}async function ul(t,e,n){if(t.b_.set("Online"),e instanceof xh&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const i of e.targetIds)t.p_.has(i)&&(await t.remoteSyncer.rejectListen(i,n),t.p_.delete(i),t.D_.removeTarget(i))}(t,e)}catch(n){Ao("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await ll(t,n)}else if(e instanceof Nh?t.D_.We(e):e instanceof Rh?t.D_.Ze(e):t.D_.je(e),!n.isEqual(Xo.min()))try{const e=await Ru(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.D_.st(e);return n.targetChanges.forEach(((n,i)=>{if(n.resumeToken.approximateByteSize()>0){const r=t.p_.get(i);r&&t.p_.set(i,r.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const i=t.p_.get(e);if(!i)return;t.p_.set(e,i.withResumeToken(Ta.EMPTY_BYTE_STRING,i.snapshotVersion)),il(t,e);const r=new su(i.target,e,n,i.sequenceNumber);nl(t,r)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){Ao("RemoteStore","Failed to raise snapshot:",e),await ll(t,e)}}async function ll(t,e,n){if(!ha(e))throw e;t.y_.add(1),await Zu(t),t.b_.set("Offline"),n||(n=()=>Ru(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Ao("RemoteStore","Retrying IndexedDB access"),await n(),t.y_.delete(1),await Yu(t)}))}async function dl(t,e){const n=Lo(t);n.asyncQueue.verifyOperationInProgress(),Ao("RemoteStore","RemoteStore received new credentials");const i=ol(n);n.y_.add(3),await Zu(n),i&&n.b_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.y_.delete(3),await Yu(n)}function fl(t){return t.v_||(t.v_=function(t,e,n){const i=Lo(t);return i.P_(),new Qu(e,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(t.datastore,t.asyncQueue,{_o:cl.bind(null,t),uo:hl.bind(null,t),r_:ul.bind(null,t)}),t.w_.push((async e=>{e?(t.v_.Go(),sl(t)?rl(t):t.b_.set("Unknown")):(await t.v_.stop(),al(t))}))),t.v_}class pl{constructor(t,e,n,i,r){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=i,this.removalCallback=r,this.deferred=new Po,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,i,r){const s=Date.now()+n,o=new pl(t,e,s,i,r);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Oo(Mo.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function gl(t,e){if(Do("AsyncQueue",`${e}: ${t}`),ha(t))return new Oo(Mo.UNAVAILABLE,`${e}: ${t}`);throw t}class ml{constructor(t){this.comparator=t?(e,n)=>t(e,n)||ea.comparator(e.key,n.key):(t,e)=>ea.comparator(t.key,e.key),this.keyedMap=Fc(),this.sortedSet=new ga(this.comparator)}static emptySet(t){return new ml(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof ml))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,i=n.getNext().key;if(!t.isEqual(i))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new ml;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class yl{constructor(){this.F_=new ga(ea.comparator)}track(t){const e=t.doc.key,n=this.F_.get(e);n?0!==t.type&&3===n.type?this.F_=this.F_.insert(e,t):3===t.type&&1!==n.type?this.F_=this.F_.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.F_=this.F_.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.F_=this.F_.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.F_=this.F_.remove(e):1===t.type&&2===n.type?this.F_=this.F_.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.F_=this.F_.insert(e,{type:2,doc:t.doc}):Ro():this.F_=this.F_.insert(e,t)}M_(){const t=[];return this.F_.inorderTraversal(((e,n)=>{t.push(n)})),t}}class vl{constructor(t,e,n,i,r,s,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=r,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,i,r){const s=[];return e.forEach((t=>{s.push({type:0,doc:t})})),new vl(t,e,ml.emptySet(e),s,n,i,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Ac(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class wl{constructor(){this.x_=void 0,this.listeners=[]}}class El{constructor(){this.queries=new Lc((t=>Dc(t)),Ac),this.onlineState="Unknown",this.O_=new Set}}function bl(t,e){const n=Lo(t);let i=!1;for(const t of e){const e=t.query,r=n.queries.get(e);if(r){for(const e of r.listeners)e.B_(t)&&(i=!0);r.x_=t}}i&&Il(n)}function Tl(t,e,n){const i=Lo(t),r=i.queries.get(e);if(r)for(const t of r.listeners)t.onError(n);i.queries.delete(e)}function Il(t){t.O_.forEach((t=>{t.next()}))}class _l{constructor(t,e,n){this.query=t,this.L_=e,this.k_=!1,this.q_=null,this.onlineState="Unknown",this.options=n||{}}B_(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new vl(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.k_?this.Q_(t)&&(this.L_.next(t),e=!0):this.K_(t,this.onlineState)&&(this.U_(t),e=!0),this.q_=t,e}onError(t){this.L_.error(t)}N_(t){this.onlineState=t;let e=!1;return this.q_&&!this.k_&&this.K_(this.q_,t)&&(this.U_(this.q_),e=!0),e}K_(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return(!this.options.W_||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}Q_(t){if(t.docChanges.length>0)return!0;const e=this.q_&&this.q_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}U_(t){t=vl.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.k_=!0,this.L_.next(t)}}class Cl{constructor(t){this.key=t}}class Sl{constructor(t){this.key=t}}class Al{constructor(t,e){this.query=t,this.X_=e,this.ea=null,this.hasCachedResults=!1,this.current=!1,this.ta=qc(),this.mutatedKeys=qc(),this.na=Rc(t),this.ra=new ml(this.na)}get ia(){return this.X_}sa(t,e){const n=e?e.oa:new yl,i=e?e.ra:this.ra;let r=e?e.mutatedKeys:this.mutatedKeys,s=i,o=!1;const a="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(((t,e)=>{const h=i.get(t),u=Nc(this.query,e)?e:null,l=!!h&&this.mutatedKeys.has(h.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let f=!1;h&&u?h.data.isEqual(u.data)?l!==d&&(n.track({type:3,doc:u}),f=!0):this._a(h,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.na(u,a)>0||c&&this.na(u,c)<0)&&(o=!0)):!h&&u?(n.track({type:0,doc:u}),f=!0):h&&!u&&(n.track({type:1,doc:h}),f=!0,(a||c)&&(o=!0)),f&&(u?(s=s.add(u),r=d?r.add(t):r.delete(t)):(s=s.delete(t),r=r.delete(t)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const t="F"===this.query.limitType?s.last():s.first();s=s.delete(t.key),r=r.delete(t.key),n.track({type:1,doc:t})}return{ra:s,oa:n,zi:o,mutatedKeys:r}}_a(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const i=this.ra;this.ra=t.ra,this.mutatedKeys=t.mutatedKeys;const r=t.oa.M_();r.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ro()}};return n(t)-n(e)}(t.type,e.type)||this.na(t.doc,e.doc))),this.aa(n);const s=e?this.ua():[],o=0===this.ta.size&&this.current?1:0,a=o!==this.ea;return this.ea=o,0!==r.length||a?{snapshot:new vl(this.query,t.ra,i,r,t.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),ca:s}:{ca:s}}N_(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({ra:this.ra,oa:new yl,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{ca:[]}}la(t){return!this.X_.has(t)&&!!this.ra.has(t)&&!this.ra.get(t).hasLocalMutations}aa(t){t&&(t.addedDocuments.forEach((t=>this.X_=this.X_.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.X_=this.X_.delete(t))),this.current=t.current)}ua(){if(!this.current)return[];const t=this.ta;this.ta=qc(),this.ra.forEach((t=>{this.la(t.key)&&(this.ta=this.ta.add(t.key))}));const e=[];return t.forEach((t=>{this.ta.has(t)||e.push(new Sl(t))})),this.ta.forEach((n=>{t.has(n)||e.push(new Cl(n))})),e}ha(t){this.X_=t.ss,this.ta=qc();const e=this.sa(t.documents);return this.applyChanges(e,!0)}Pa(){return vl.fromInitialDocuments(this.query,this.ra,this.mutatedKeys,0===this.ea,this.hasCachedResults)}}class Dl{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class kl{constructor(t){this.key=t,this.Ia=!1}}class Nl{constructor(t,e,n,i,r,s){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=s,this.Ta={},this.Ea=new Lc((t=>Dc(t)),Ac),this.da=new Map,this.Aa=new Set,this.Ra=new ga(ea.comparator),this.Va=new Map,this.ma=new vu,this.fa={},this.ga=new Map,this.pa=du.On(),this.onlineState="Unknown",this.ya=void 0}get isPrimaryClient(){return!0===this.ya}}async function Rl(t,e){const n=function(t){const e=Lo(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Ll.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=ql.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Ol.bind(null,e),e.Ta.r_=bl.bind(null,e.eventManager),e.Ta.Sa=Tl.bind(null,e.eventManager),e}(t);let i,r;const s=n.Ea.get(e);if(s)i=s.targetId,n.sharedClientState.addLocalQueryTarget(i),r=s.view.Pa();else{const t=await function(t,e){const n=Lo(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let i;return n.kr.getTargetData(t,e).next((r=>r?(i=r,ca.resolve(i)):n.kr.allocateTargetId(t).next((r=>(i=new su(e,r,"TargetPurposeListen",t.currentSequenceNumber),n.kr.addTargetData(t,i).next((()=>i)))))))})).then((t=>{const i=n.Ji.get(t.targetId);return(null===i||t.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ji=n.Ji.insert(t.targetId,t),n.Yi.set(e,t.targetId)),t}))}(n.localStore,Cc(e)),s=n.sharedClientState.addLocalQueryTarget(t.targetId);i=t.targetId,r=await async function(t,e,n,i,r){t.wa=(e,n,i)=>async function(t,e,n,i){let r=e.view.sa(n);r.zi&&(r=await Lu(t.localStore,e.query,!1).then((({documents:t})=>e.view.sa(t,r))));const s=i&&i.targetChanges.get(e.targetId),o=e.view.applyChanges(r,t.isPrimaryClient,s);return Vl(t,e.targetId,o.ca),o.snapshot}(t,e,n,i);const s=await Lu(t.localStore,e,!0),o=new Al(e,s.ss),a=o.sa(s.documents),c=kh.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==t.onlineState,r),h=o.applyChanges(a,t.isPrimaryClient,c);Vl(t,n,h.ca);const u=new Dl(e,n,o);return t.Ea.set(e,u),t.da.has(n)?t.da.get(n).push(e):t.da.set(n,[e]),h.snapshot}(n,e,i,"current"===s,t.resumeToken),n.isPrimaryClient&&tl(n.remoteStore,t)}return r}async function xl(t,e){const n=Lo(t),i=n.Ea.get(e),r=n.da.get(i.targetId);if(r.length>1)return n.da.set(i.targetId,r.filter((t=>!Ac(t,e)))),void n.Ea.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await xu(n.localStore,i.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(i.targetId),el(n.remoteStore,i.targetId),Pl(n,i.targetId)})).catch(aa)):(Pl(n,i.targetId),await xu(n.localStore,i.targetId,!0))}async function Ll(t,e){const n=Lo(t);try{const t=await function(t,e){const n=Lo(t),i=e.snapshotVersion;let r=n.Ji;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const s=n.Xi.newChangeBuffer({trackRemovals:!0});r=n.Ji;const o=[];e.targetChanges.forEach(((s,a)=>{const c=r.get(a);if(!c)return;o.push(n.kr.removeMatchingKeys(t,s.removedDocuments,a).next((()=>n.kr.addMatchingKeys(t,s.addedDocuments,a))));let h=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?h=h.withResumeToken(Ta.EMPTY_BYTE_STRING,Xo.min()).withLastLimboFreeSnapshotVersion(Xo.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,i)),r=r.insert(a,h),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,h,s)&&o.push(n.kr.updateTargetData(t,h))}));let a=Oc(),c=qc();if(e.documentUpdates.forEach((i=>{e.resolvedLimboDocuments.has(i)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,i))})),o.push(function(t,e,n){let i=qc(),r=qc();return n.forEach((t=>i=i.add(t))),e.getEntries(t,i).next((t=>{let i=Oc();return n.forEach(((n,s)=>{const o=t.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(r=r.add(n)),s.isNoDocument()&&s.version.isEqual(Xo.min())?(e.removeEntry(n,s.readTime),i=i.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(s),i=i.insert(n,s)):Ao("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{ns:i,rs:r}}))}(t,s,e.documentUpdates).next((t=>{a=t.ns,c=t.rs}))),!i.isEqual(Xo.min())){const e=n.kr.getLastRemoteSnapshotVersion(t).next((e=>n.kr.setTargetsMetadata(t,t.currentSequenceNumber,i)));o.push(e)}return ca.waitFor(o).next((()=>s.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.Ji=r,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const i=n.Va.get(e);i&&(xo(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?i.Ia=!0:t.modifiedDocuments.size>0?xo(i.Ia):t.removedDocuments.size>0&&(xo(i.Ia),i.Ia=!1))})),await jl(n,t,e)}catch(t){await aa(t)}}function Ml(t,e,n){const i=Lo(t);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const t=[];i.Ea.forEach(((n,i)=>{const r=i.view.N_(e);r.snapshot&&t.push(r.snapshot)})),function(t,e){const n=Lo(t);n.onlineState=e;let i=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.N_(e)&&(i=!0)})),i&&Il(n)}(i.eventManager,e),t.length&&i.Ta.r_(t),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function Ol(t,e,n){const i=Lo(t);i.sharedClientState.updateQueryState(e,"rejected",n);const r=i.Va.get(e),s=r&&r.key;if(s){let t=new ga(ea.comparator);t=t.insert(s,Qa.newNoDocument(s,Xo.min()));const n=qc().add(s),r=new Dh(Xo.min(),new Map,new ga(Go),t,n);await Ll(i,r),i.Ra=i.Ra.remove(s),i.Va.delete(e),Bl(i)}else await xu(i.localStore,e,!1).then((()=>Pl(i,e,n))).catch(aa)}function Pl(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const i of t.da.get(e))t.Ea.delete(i),n&&t.Ta.Sa(i,n);t.da.delete(e),t.isPrimaryClient&&t.ma.Ar(e).forEach((e=>{t.ma.containsKey(e)||Fl(t,e)}))}function Fl(t,e){t.Aa.delete(e.path.canonicalString());const n=t.Ra.get(e);null!==n&&(el(t.remoteStore,n),t.Ra=t.Ra.remove(e),t.Va.delete(n),Bl(t))}function Vl(t,e,n){for(const i of n)i instanceof Cl?(t.ma.addReference(i.key,e),Ul(t,i)):i instanceof Sl?(Ao("SyncEngine","Document no longer in limbo: "+i.key),t.ma.removeReference(i.key,e),t.ma.containsKey(i.key)||Fl(t,i.key)):Ro()}function Ul(t,e){const n=e.key,i=n.path.canonicalString();t.Ra.get(n)||t.Aa.has(i)||(Ao("SyncEngine","New document in limbo: "+n),t.Aa.add(i),Bl(t))}function Bl(t){for(;t.Aa.size>0&&t.Ra.size<t.maxConcurrentLimboResolutions;){const e=t.Aa.values().next().value;t.Aa.delete(e);const n=new ea(Yo.fromString(e)),i=t.pa.next();t.Va.set(i,new kl(n)),t.Ra=t.Ra.insert(n,i),tl(t.remoteStore,new su(Cc(Tc(n.path)),i,"TargetPurposeLimboResolution",ua.ae))}}async function jl(t,e,n){const i=Lo(t),r=[],s=[],o=[];i.Ea.isEmpty()||(i.Ea.forEach(((t,a)=>{o.push(i.wa(a,e,n).then((t=>{if((t||n)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){r.push(t);const e=Au.qi(a.targetId,t);s.push(e)}})))})),await Promise.all(o),i.Ta.r_(r),await async function(t,e){const n=Lo(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>ca.forEach(e,(e=>ca.forEach(e.Li,(i=>n.persistence.referenceDelegate.addReference(t,e.targetId,i))).next((()=>ca.forEach(e.ki,(i=>n.persistence.referenceDelegate.removeReference(t,e.targetId,i)))))))))}catch(t){if(!ha(t))throw t;Ao("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Ji.get(e),i=t.snapshotVersion,r=t.withLastLimboFreeSnapshotVersion(i);n.Ji=n.Ji.insert(e,r)}}}(i.localStore,s))}async function $l(t,e){const n=Lo(t);if(!n.currentUser.isEqual(e)){Ao("SyncEngine","User change. New user:",e.toKey());const t=await Nu(n.localStore,e);n.currentUser=e,function(t,e){t.ga.forEach((t=>{t.forEach((t=>{t.reject(new Oo(Mo.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.ga.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await jl(n,t.ts)}}function ql(t,e){const n=Lo(t),i=n.Va.get(e);if(i&&i.Ia)return qc().add(i.key);{let t=qc();const i=n.da.get(e);if(!i)return t;for(const e of i){const i=n.Ea.get(e);t=t.unionWith(i.view.ia)}return t}}class zl{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=Ku(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return function(t,e,n,i){return new ku(t,e,n,i)}(this.persistence,new Du,t.initialUser,this.serializer)}createPersistence(t){return new _u(Su.zr,this.serializer)}createSharedClientState(t){return new Ou}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Kl{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Ml(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=$l.bind(null,this.syncEngine),await async function(t,e){const n=Lo(t);e?(n.y_.delete(2),await Yu(n)):e||(n.y_.add(2),await Zu(n),n.b_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new El}createDatastore(t){const e=Ku(t.databaseInfo.databaseId),n=function(t){return new qu(t)}(t.databaseInfo);return function(t,e,n,i){return new Wu(t,e,n,i)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,i,r){return new Ju(t,e,n,i,r)}(this.localStore,this.datastore,t.asyncQueue,(t=>Ml(this.syncEngine,t,0)),Fu.v()?new Fu:new Pu)}createSyncEngine(t,e){return function(t,e,n,i,r,s,o){const a=new Nl(t,e,n,i,r,s);return o&&(a.ya=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=Lo(t);Ao("RemoteStore","RemoteStore shutting down."),e.y_.add(5),await Zu(e),e.S_.shutdown(),e.b_.set("Unknown")}(this.remoteStore)}}class Hl{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.va(this.observer.next,t)}error(t){this.observer.error?this.va(this.observer.error,t):Do("Uncaught Error in snapshot listener:",t.toString())}Ca(){this.muted=!0}va(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class Gl{constructor(t,e,n,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=i,this.user=Io.UNAUTHENTICATED,this.clientId=Ho.V(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{Ao("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(Ao("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Oo(Mo.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Po;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=gl(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Ql(t,e){t.asyncQueue.verifyOperationInProgress(),Ao("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let i=n.initialUser;t.setCredentialChangeListener((async t=>{i.isEqual(t)||(await Nu(e.localStore,t),i=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function Wl(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Ao("FirestoreClient","Using user provided OfflineComponentProvider");try{await Ql(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===Mo.FAILED_PRECONDITION||t.code===Mo.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;ko("Error using user provided cache. Falling back to memory cache: "+n),await Ql(t,new zl)}}else Ao("FirestoreClient","Using default OfflineComponentProvider"),await Ql(t,new zl);return t._offlineComponents}(t);Ao("FirestoreClient","Initializing OnlineComponentProvider");const i=await t.getConfiguration();await e.initialize(n,i),t.setCredentialChangeListener((t=>dl(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>dl(e.remoteStore,n))),t._onlineComponents=e}async function Xl(t){const e=await async function(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Ao("FirestoreClient","Using user provided OnlineComponentProvider"),await Wl(t,t._uninitializedComponentsProvider._online)):(Ao("FirestoreClient","Using default OnlineComponentProvider"),await Wl(t,new Kl))),t._onlineComponents}(t),n=e.eventManager;return n.onListen=Rl.bind(null,e.syncEngine),n.onUnlisten=xl.bind(null,e.syncEngine),n}function Jl(t,e,n={}){const i=new Po;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,i,r){const s=new Hl({next:n=>{e.enqueueAndForget((()=>async function(t,e){const n=Lo(t),i=e.query;let r=!1;const s=n.queries.get(i);if(s){const t=s.listeners.indexOf(e);t>=0&&(s.listeners.splice(t,1),r=0===s.listeners.length)}if(r)return n.queries.delete(i),n.onUnlisten(i)}(t,o))),n.fromCache&&"server"===i.source?r.reject(new Oo(Mo.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(n)},error:t=>r.reject(t)}),o=new _l(n,s,{includeMetadataChanges:!0,W_:!0});return async function(t,e){const n=Lo(t),i=e.query;let r=!1,s=n.queries.get(i);if(s||(r=!0,s=new wl),r)try{s.x_=await n.onListen(i)}catch(t){const n=gl(t,`Initialization of query '${kc(e.query)}' failed`);return void e.onError(n)}n.queries.set(i,s),s.listeners.push(e),e.N_(n.onlineState),s.x_&&e.B_(s.x_)&&Il(n)}(t,o)}(await Xl(t),t.asyncQueue,e,n,i))),i.promise}function Yl(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const Zl=new Map;function td(t){if(ea.isDocumentKey(t))throw new Oo(Mo.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function ed(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Oo(Mo.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=function(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Ro()}(t);throw new Oo(Mo.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class nd{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new Oo(Mo.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Oo(Mo.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,i){if(!0===e&&!0===i)throw new Oo(Mo.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Yl(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new Oo(Mo.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new Oo(Mo.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new Oo(Mo.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class id{constructor(t,e,n,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new nd({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Oo(Mo.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Oo(Mo.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new nd(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Vo;switch(t.type){case"firstParty":return new $o(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new Oo(Mo.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Zl.get(t);e&&(Ao("ComponentProvider","Removing Datastore"),Zl.delete(t),e.terminate())}(this),Promise.resolve()}}class rd{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new rd(this.firestore,t,this._query)}}class sd{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new od(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new sd(this.firestore,t,this._key)}}class od extends rd{constructor(t,e,n){super(t,e,Tc(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new sd(this.firestore,null,new ea(t))}withConverter(t){return new od(this.firestore,t,this._path)}}class ad{constructor(){this.Wa=Promise.resolve(),this.Ga=[],this.za=!1,this.ja=[],this.Ha=null,this.Ja=!1,this.Ya=!1,this.Za=[],this.Ko=new Hu(this,"async_queue_retry"),this.Xa=()=>{const t=zu();t&&Ao("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Ko.No()};const t=zu();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Xa)}get isShuttingDown(){return this.za}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.eu(),this.tu(t)}enterRestrictedMode(t){if(!this.za){this.za=!0,this.Ya=t||!1;const e=zu();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Xa)}}enqueue(t){if(this.eu(),this.za)return new Promise((()=>{}));const e=new Po;return this.tu((()=>this.za&&this.Ya?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Ga.push(t),this.nu())))}async nu(){if(0!==this.Ga.length){try{await this.Ga[0](),this.Ga.shift(),this.Ko.reset()}catch(t){if(!ha(t))throw t;Ao("AsyncQueue","Operation failed with retryable error: "+t)}this.Ga.length>0&&this.Ko.xo((()=>this.nu()))}}tu(t){const e=this.Wa.then((()=>(this.Ja=!0,t().catch((t=>{this.Ha=t,this.Ja=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw Do("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.Ja=!1,t))))));return this.Wa=e,e}enqueueAfterDelay(t,e,n){this.eu(),this.Za.indexOf(t)>-1&&(e=0);const i=pl.createAndSchedule(this,t,e,n,(t=>this.ru(t)));return this.ja.push(i),i}eu(){this.Ha&&Ro()}verifyOperationInProgress(){}async iu(){let t;do{t=this.Wa,await t}while(t!==this.Wa)}su(t){for(const e of this.ja)if(e.timerId===t)return!0;return!1}ou(t){return this.iu().then((()=>{this.ja.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.ja)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.iu()}))}_u(t){this.Za.push(t)}ru(t){const e=this.ja.indexOf(t);this.ja.splice(e,1)}}class cd extends id{constructor(t,e,n,i){super(t,e,n,i),this.type="firestore",this._queue=new ad,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||hd(this),this._firestoreClient.terminate()}}function hd(t){var e,n,i;const r=t._freezeSettings(),s=function(t,e,n,i){return new Na(t,e,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,Yl(i.experimentalLongPollingOptions),i.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,r);t._firestoreClient=new Gl(t._authCredentials,t._appCheckCredentials,t._queue,s),(null===(n=r.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(i=r.localCache)||void 0===i?void 0:i._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:r.localCache.kind,_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider})}class ud{constructor(t){this._byteString=t}static fromBase64String(t){try{return new ud(Ta.fromBase64String(t))}catch(t){throw new Oo(Mo.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new ud(Ta.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class ld{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Oo(Mo.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ta(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class dd{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Oo(Mo.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Oo(Mo.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Go(this._lat,t._lat)||Go(this._long,t._long)}}const fd=new RegExp("[~\\*/\\[\\]]");function pd(t,e,n,i,r){const s=i&&!i.isEmpty(),o=void 0!==r;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${i}`),o&&(c+=` in document ${r}`),c+=")"),new Oo(Mo.INVALID_ARGUMENT,a+t+c)}class gd{constructor(t,e,n,i,r){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new sd(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new md(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(yd("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class md extends gd{data(){return super.data()}}function yd(t,e){return"string"==typeof e?function(t,e,n){if(e.search(fd)>=0)throw pd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new ld(...e.split("."))._internalPath}catch(i){throw pd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}(t,e):e instanceof ld?e._internalPath:e._delegate._internalPath}class vd{convertValue(t,e="none"){switch(La(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ca(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Sa(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Ro()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return pa(t,((t,i)=>{n[t]=this.convertValue(i,e)})),n}convertGeoPoint(t){return new dd(Ca(t.latitude),Ca(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Da(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(ka(t));default:return null}}convertTimestamp(t){const e=_a(t);return new Wo(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=Yo.fromString(t);xo(ru(n));const i=new Ra(n.get(1),n.get(3)),r=new ea(n.popFirst(5));return i.isEqual(e)||Do(`Document ${r} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),r}}class wd{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Ed extends gd{constructor(t,e,n,i,r,s){super(t,e,n,i,s),this._firestore=t,this._firestoreImpl=t,this.metadata=r}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new bd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(yd("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class bd extends Ed{data(t={}){return super.data(t)}}class Td{constructor(t,e,n,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new wd(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new bd(this._firestore,this._userDataWriter,n.key,n,new wd(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Oo(Mo.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const i=new bd(t._firestore,t._userDataWriter,n.doc.key,n.doc,new wd(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:i,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const i=new bd(t._firestore,t._userDataWriter,e.doc.key,e.doc,new wd(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let r=-1,s=-1;return 0!==e.type&&(r=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),s=n.indexOf(e.doc.key)),{type:Id(e.type),doc:i,oldIndex:r,newIndex:s}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Id(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ro()}}class _d extends vd{constructor(t){super(),this.firestore=t}convertBytes(t){return new ud(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new sd(this.firestore,null,e)}}!function(t,e=!0){_o="10.1.0",st(new b("firestore",((t,{instanceIdentifier:n,options:i})=>{const r=t.getProvider("app").getImmediate(),s=new cd(new Bo(t.getProvider("auth-internal")),new zo(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Oo(Mo.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ra(t.options.projectId,e)}(r,n),r);return i=Object.assign({useFetchStreams:e},i),s._setSettings(i),s}),"PUBLIC").setMultipleInstances(!0)),lt(To,"4.1.0",t),lt(To,"4.1.0","esm2017")}(),function(t=ut()){const e=ot(t=E(t),Se);e.isInitialized()?e.getImmediate():function(t,e={}){const n=ot(t,Se);if(n.isInitialized()){const t=n.getImmediate();if(f(e,n.getOptions()))return t;throw Le.create("already-initialized")}n.initialize({options:e})}(t)}(ht({apiKey:"AIzaSyAdBEuDofYesQqhCszdnyMYmbHkfkekWgw",authDomain:"my-project-firebase-test-001.firebaseapp.com",projectId:"my-project-firebase-test-001",storageBucket:"my-project-firebase-test-001.appspot.com",messagingSenderId:"1068303770904",appId:"1:1068303770904:web:2758f78c9dfb1a3e9d2a6d",measurementId:"G-NJYVWPLQ2H"}));const Cd=function(t,e,...n){if(t=E(t),function(t,e,n){if(!n)throw new Oo(Mo.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}("collection","path",e),t instanceof id){const i=Yo.fromString(e,...n);return td(i),new od(t,null,i)}{if(!(t instanceof sd||t instanceof od))throw new Oo(Mo.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=t._path.child(Yo.fromString(e,...n));return td(i),new od(t.firestore,null,i)}}(function(t,e){const n=ot(ut(),"firestore").getImmediate({identifier:"(default)"});if(!n._initialized){const t=(t=>{const e=(t=>{var e,n;return null===(n=null===(e=s())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),i]:[e.substring(0,n),i]})("firestore");t&&function(t,e,n,i={}){var s;const o=(t=ed(t,id))._getSettings(),a=`${e}:${n}`;if("firestore.googleapis.com"!==o.host&&o.host!==a&&ko("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),i.mockUserToken){let e,n;if("string"==typeof i.mockUserToken)e=i.mockUserToken,n=Io.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",i=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[r(JSON.stringify({alg:"none",type:"JWT"})),r(JSON.stringify(o)),""].join(".")}(i.mockUserToken,null===(s=t._app)||void 0===s?void 0:s.options.projectId);const o=i.mockUserToken.sub||i.mockUserToken.user_id;if(!o)throw new Oo(Mo.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Io(o)}t._authCredentials=new Uo(new Fo(e,n))}}(n,...t)}return n}(),"movie");(function(t){t=ed(t,rd);const e=ed(t.firestore,cd),n=function(t){return t._firestoreClient||hd(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}(e),i=new _d(e);return function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new Oo(Mo.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query),Jl(n,t._query).then((n=>new Td(e,i,t,n)))})(Cd).then((t=>{t.docs.forEach((t=>{console.log(t.id),console.log(t.data())}))})).catch(console.log("error"))})();